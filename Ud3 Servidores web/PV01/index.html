
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://laura-agut.github.io/Despliegue/Ud3%20Servidores%20web/PV01/">
      
      
        <link rel="prev" href="../P06DockerizacionPHPNginx/">
      
      
        <link rel="next" href="../PV02/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>Pr√°ctica Voluntaria 3.1 ‚Äì Proxy inverso con Nginx - Despliegue de aplicaciones web</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#practica-voluntaria-31-proxy-inverso-con-nginx" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="Despliegue de aplicaciones web" class="md-header__button md-logo" aria-label="Despliegue de aplicaciones web" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Despliegue de aplicaciones web
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Pr√°ctica Voluntaria 3.1 ‚Äì Proxy inverso con Nginx
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="Cambiar a modo oscuro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo oscuro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Cambiar a modo claro"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo claro" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="B√∫squeda" placeholder="B√∫squeda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando b√∫squeda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegaci√≥n" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Despliegue de aplicaciones web" class="md-nav__button md-logo" aria-label="Despliegue de aplicaciones web" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Despliegue de aplicaciones web
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Despliegue de aplicaciones web
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Ud0 Introduccion
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Ud0 Introduccion
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/Ud0_1Introalmodulo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.1. Introducci√≥n al m√≥dulo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/Ud0_2AWS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.2. Introducci√≥n a AWS Academy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/ejercicio-final-ebs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    üß™ Ejercicio final: modifica, prueba en local y despliega en Elastic Beanstalk
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pr√°cticas
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Pr√°cticas
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.1. Linux Server en AWSAcademy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.2 Windows Server en AWSAcademy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.3. Conceder acceso a un segundo administrador
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.4. Comandos b√°sicos Linux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.5: Despliegue Java en AWS Elastic Beanstalk
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="practica-voluntaria-31-proxy-inverso-con-nginx">Pr√°ctica Voluntaria 3.1 ‚Äì Proxy inverso con Nginx</h1>
<h2 id="requisitos-antes-de-comenzar-la-practica">Requisitos antes de comenzar  la pr√°ctica</h2>
<div class="admonition danger">
<p class="admonition-title">Atenci√≥n, importante antes de comenzar</p>
<ul>
<li>La pr√°ctica 2.1 ha de estar funcionando correctamente</li>
<li>No comenzar la pr√°ctica antes de tener la 2.1 <strong><em>funcionando y comprobada</em></strong></li>
</ul>
</div>
<h2 id="introduccion">Introducci√≥n</h2>
<h3 id="que-es-un-servidor-proxy">¬øQu√© es un servidor proxy?</h3>
<p>Un proxy de reenv√≠o, a menudo llamado proxy, servidor proxy o proxy web, es un servidor que se encuentra frente a un grupo de m√°quinas cliente. Cuando esas m√°quinas realizan solicitudes a sitios y servicios en Internet, el servidor proxy intercepta esas solicitudes y luego se comunica con los servidores web en nombre de esos clientes, como un intermediario. </p>
<p>Por ejemplo, tomemos como ejemplo 3 m√°quinas involucradas en una comunicaci√≥n t√≠pica de proxy de reenv√≠o: </p>
<ul>
<li>
<p>A: Esta es la m√°quina del hogar de un usuario. </p>
</li>
<li>
<p>B: este es un servidor proxy de reenv√≠o </p>
</li>
<li>
<p>C: este es el servidor de origen de un sitio web (donde se almacenan los datos del sitio web) </p>
</li>
</ul>
<p><img alt="" src="../../img/4.1-7.png" /></p>
<p>En una comunicaci√≥n est√°ndar por Internet, la m√°quina A se comunicar√≠a directamente con la m√°quina C, con el cliente enviando solicitudes al servidor de origen y el servidor de origen respondiendo al cliente. Cuando hay un proxy de reenv√≠o, A enviar√° solicitudes a B, que luego reenviar√° la solicitud a C. C enviar√° una respuesta a B, que reenviar√° la respuesta a A. </p>
<p>¬øPor qu√© agregar este intermediario adicional a nuestra actividad en Internet? </p>
<p><img alt="" src="../../img/proxy.jpg" /></p>
<p>Hay algunas razones por las que uno podr√≠a querer usar un proxy de reenv√≠o: </p>
<ul>
<li>
<p><strong><em>Para evitar restricciones de navegaci√≥n estatales o institucionales</em></strong>: algunos gobiernos, escuelas y otras organizaciones usan firewalls para dar a sus usuarios acceso a una versi√≥n limitada de Internet. Se puede usar un proxy de reenv√≠o para sortear estas restricciones, ya que permiten que el usuario se conecte al proxy en lugar de directamente a los sitios que est√° visitando. </p>
</li>
<li>
<p><strong><em>Para bloquear el acceso a cierto contenido</em></strong>: a la inversa, los proxies tambi√©n se pueden configurar para bloquear el acceso de un grupo de usuarios a ciertos sitios. Por ejemplo, una red escolar puede estar configurada para conectarse a la web a trav√©s de un proxy que habilita reglas de filtrado de contenido, neg√°ndose a reenviar respuestas de Facebook y otros sitios de redes sociales. </p>
</li>
<li>
<p><strong><em>Para proteger su identidad en l√≠nea</em></strong>: en algunos casos, los usuarios habituales de Internet simplemente desean un mayor anonimato en l√≠nea, pero en otros casos, los usuarios de Internet viven en lugares donde el gobierno puede imponer graves consecuencias a los disidentes pol√≠ticos. Criticar al gobierno en un foro web o en las redes sociales puede dar lugar a multas o encarcelamiento para estos usuarios. Si uno de estos disidentes usa un proxy de reenv√≠o para conectarse a un sitio web donde publica comentarios pol√≠ticamente sensibles, la direcci√≥n IP utilizada para publicar los comentarios ser√° m√°s dif√≠cil de rastrear hasta el disidente. Solo estar√° visible la direcci√≥n IP del servidor proxy. </p>
</li>
</ul>
<h3 id="en-que-se-diferencia-un-proxy-inverso">¬øEn qu√© se diferencia un proxy inverso?</h3>
<p>Estar√≠amos hablando del caso opuesto al anterior. </p>
<p>Un proxy inverso es un servidor que se encuentra frente a uno o m√°s servidores web, interceptando las solicitudes de los clientes. Esto es diferente de un proxy de reenv√≠o, donde el proxy se encuentra frente a los clientes. Con un proxy inverso, cuando los clientes env√≠an solicitudes al servidor de un sitio web, esas solicitudes son interceptadas en la frontera de la red por el servidor proxy inverso. El servidor proxy inverso enviar√° solicitudes y recibir√° respuestas del servidor del sitio web. </p>
<p>La diferencia entre un proxy directo y inverso es sutil pero importante. Una forma simplificada de resumir ser√≠a decir que un <strong>proxy de reenv√≠o</strong> <u>se encuentra frente a un cliente y garantiza que ning√∫n servidor de origen se comunique nunca directamente con ese cliente espec√≠fico</u>. Por otro lado, un <strong>proxy inverso</strong> <u>se encuentra frente a un servidor de origen y garantiza que ning√∫n cliente se comunique nunca directamente con ese servidor de origen</u>. </p>
<p>Una vez m√°s, ilustremos nombrando las m√°quinas involucradas: </p>
<ul>
<li>
<p>D: cualquier n√∫mero de ordenadores dom√©sticos de los usuarios </p>
</li>
<li>
<p>E: este es un servidor proxy inverso </p>
</li>
<li>
<p>F: uno o m√°s servidores de origen </p>
</li>
</ul>
<p><img alt="" src="../../img/4.1-8.png" /></p>
<p>Normalmente, todas las solicitudes de D ir√≠an directamente a F, y F enviar√≠a respuestas directamente a D. Con un proxy inverso, todas las solicitudes de D ir√°n directamente a E, y E enviar√° sus solicitudes ay recibir√° respuestas de F. E luego transmita las respuestas apropiadas a D. </p>
<p>A continuaci√≥n se describen algunos de los beneficios de un proxy inverso: </p>
<ul>
<li>
<p><strong>Balanceo de carga</strong>: es posible que un sitio web popular que recibe millones de usuarios todos los d√≠as no pueda manejar todo el tr√°fico entrante del sitio con un solo servidor de origen. En cambio, el sitio se puede distribuir entre un grupo de servidores diferentes, todos manejando solicitudes para el mismo sitio. En este caso, un proxy inverso puede proporcionar una soluci√≥n de balanceo de carga que distribuir√° el tr√°fico entrante de manera uniforme entre los diferentes servidores para evitar que un solo servidor se sobrecargue. En el caso de que un servidor falle por completo, otros servidores pueden intensificar para manejar el tr√°fico. </p>
</li>
<li>
<p><strong>Protecci√≥n contra ataques</strong>: con un proxy inverso en su lugar, un sitio web o servicio nunca necesita revelar la direcci√≥n IP de su (s) servidor (es) de origen. Esto hace que sea mucho m√°s dif√≠cil para los atacantes aprovechar un ataque dirigido contra ellos, como un ataque DdoS. </p>
</li>
<li>
<p><strong>Almacenamiento en cach</strong>√©: un proxy inverso tambi√©n puede almacenar contenido en cach√© , lo que resulta en un rendimiento m√°s r√°pido. Por ejemplo, si un usuario en Par√≠s visita un sitio web con proxy inverso con servidores web en Los √Ångeles, el usuario podr√≠a conectarse a un servidor proxy inverso local en Par√≠s, que luego tendr√° que comunicarse con un servidor de origen en Los √Ångeles. El servidor proxy luego puede almacenar en cach√© (o guardar temporalmente) los datos de respuesta. Los usuarios parisinos posteriores que naveguen por el sitio obtendr√°n la versi√≥n en cach√© local del servidor proxy inverso parisino, lo que dar√° como resultado un rendimiento mucho m√°s r√°pido. </p>
</li>
<li>
<p><strong>Cifrado SSL</strong> - Cifrado y descifrado SSL (o TLS comunicaciones) para cada cliente pueden ser computacionalmente caro para un servidor de origen. Se puede configurar un proxy inverso para descifrar todas las solicitudes entrantes y cifrar todas las respuestas salientes, liberando valiosos recursos en el servidor de origen. </p>
</li>
</ul>
<p><img alt="" src="../../img/Reverse_Proxy.png" /></p>
<h2 id="tarea">Tarea</h2>
<h3 id="configuraciones">Configuraciones</h3>
<h4 id="nginx-servidor-web">Nginx servidor web</h4>
<p>Vamos a configurar dos Debian con sendos servidores Nginx. Ten√©is la m√°quina virtual inicial y deb√©is clonarla para tener una segunda: </p>
<ul>
<li>
<p>Uno servir√° las p√°ginas web que ya hemos configurado, as√≠ pues utilizaremos el servidor que ya tenemos configurado de la Pr√°ctica 2.1. </p>
</li>
<li>
<p>El nuevo servidor clon Debian con Nginx configurado como proxy inverso</p>
</li>
<li>
<p>Realizaremos las peticiones HTTP desde el navegador web de nuestra m√°quina f√≠sica/anfitri√≥n hacia el proxy clonado, que nos redirigir√° al servidor web original</p>
</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Cuidado</p>
<p>Ojo al clonar las m√°quinas virtuales porque hay que darle a crear una nueva MAC, de lo contrario no tendr√©is IP en esa m√°quina.</p>
</div>
<p>El diagrama de red quedar√≠a as√≠: </p>
<p><img alt="" src="../../img/p2.3.png" /></p>
<p>Para que todo quede m√°s diferenciado y os quede m√°s claro que la petici√≥n est√° pasando por el proxy inverso y llega al servidor web destino, vamos a hacer que cada uno de los servidores escuche las peticiones en un puerto distinto. </p>
<ol>
<li>
<p>En primer lugar, deb√©is cambiar el nombre que tuviera vuestra web por el de <code>webserver</code>, ello implica: </p>
<ul>
<li>
<p>Cambiar el nombre del archivo de configuraci√≥n de sitios disponibles par Nginx</p>
</li>
<li>
<p>Cambiar el nombre del sitio web dentro de este archivo de configuraci√≥n donde haga falta </p>
</li>
<li>
<p>No os olvid√©is de eliminar el link simb√≥lico antiguo  con el comando <code>unlink nombre_del_link</code> dentro de la carpeta <code>sites-enabled</code> y crear el nuevo para el nuevo nombre de archivo. </p>
</li>
</ul>
</li>
<li>
<p>En el archivo de configuraci√≥n del sitio web, en lugar de hacer que el servidor escuche en el puerto 80, cambiadlo al 8080. </p>
</li>
<li>
<p>Reiniciar Nginx </p>
</li>
</ol>
<h4 id="nginx-proxy-inverso">Nginx proxy inverso</h4>
<p>Ahora, cuando intentamos acceder a <code>http://ejemplo-proxy</code> (o el nombre que tuvier√°is de vuestra web de las pr√°cticas anteriores), en realidad estaremos accediendo al proxy, que nos redirigir√° a <code>http://webserver:8080</code>, el servidor web que acabamos de configurar para que escuche con ese nombre en el puerto 8080. </p>
<p>Para ello: </p>
<ul>
<li>
<p>Crear un archivo de configuraci√≥n en <em>sites-available</em> con el nombre <code>ejemplo-proxy</code> (o el que tuvier√°is vosotros) </p>
</li>
<li>
<p>Este archivo de configuraci√≥n ser√° m√°s simple, tendr√° la siguiente forma </p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nb">server</span><span class="w"> </span>{<span class="w"> </span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="hll"><span class="w">    </span><span class="nb">listen</span><span class="w"> </span>__;<span class="w"> </span>
</span><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="hll"><span class="w">    </span><span class="nb">server_name</span><span class="w"> </span>____________;<span class="w"> </span>
</span><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="nb">location</span><span class="w"> </span>/<span class="w"> </span>{<span class="w"> </span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="hll"><span class="w">    </span><span class="nb">proxy_pass</span><span class="w"> </span>http://_________:____;<span class="w"> </span>
</span><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="err">}</span><span class="w"> </span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="err">}</span><span class="w"> </span>
</code></pre></div>
<p>Donde, <strong><em>mirando el diagrama de red y teniendo en cuenta la configuraci√≥n hecha hasta ahora</em></strong>, deb√©is completar: </p>
<ul>
<li>
<p>El puerto donde est√° escuchando el proxy inverso </p>
</li>
<li>
<p>El nombre de vuestro dominio o sitio web original al que accedemos en el proxy </p>
</li>
<li>
<p>La directiva <code>proxy_pass</code> indica a d√≥nde se van a redirigir las peticiones, esto es, al servidor web. Por tanto, deb√©is poner la IP y n√∫mero de puerto adecuados de vuestro sitio web configurado en el apartado anterior. </p>
</li>
<li>
<p>Crear el link simb√≥lico pertinente </p>
</li>
</ul>
<p>Esto es para simular la situaci√≥n en la que nosotros, como clientes, cuando accedamos a nuestro sitio web, no necesitemos saber c√≥mo est√° todo configurado, s√≥lo necesitamos saber el nombre de la web. </p>
<div class="admonition warning">
<p class="admonition-title">¬°Atenci√≥n, muy importante!</p>
<p><strong>Deb√©is modificar el archivo host que configurast√©is en la pr√°ctica 2.1. Si mir√°is el diagrama de red, ahora el nombre de vuestro sitio web se corresponder√° con la IP de la nueva m√°quina clon que hace de proxy</strong>. Ser√° √©sta la encargada de redirigirnos autom√°ticamente al verdadero sitio web.</p>
</div>
<h2 id="comprobaciones">Comprobaciones</h2>
<p>Si acced√©is a vuestro sitio web, deb√©is poder seguir accediendo sin problemas. </p>
<ul>
<li>
<p>Comprobad en los access.log de los dos servidores que llega la petici√≥n </p>
</li>
<li>
<p>Comprobad adem√°s la petici√≥n y respuesta con las herramientas de desarrollador de Firefox en Xubuntu. Pulsando F12 en el navegador os aparecer√°n estas herramientas</p>
</li>
</ul>
<p><img alt="" src="../../img/4.1-10.png" /></p>
<p>En la primera petici√≥n (marcada en rojo), utilizando el apartado ‚ÄúRed‚Äù (tambi√©n marcado en rojo) y tambi√©n en rojo est√° se√±alado d√≥nde se puede ver la respuesta de la petici√≥n GET HTTP (200 OK). </p>
<p>Tambi√©n vemos las cabeceras que se incluyen en la petici√≥n (m√©todo GET) y en la respuesta a esta petici√≥n. </p>
<h3 id="anadiendo-cabeceras">A√±adiendo cabeceras</h3>
<p>Adem√°s de haber mirado los logs, vamos a demostrar a√∫n de forma m√°s clara que la petici√≥n est√° pasando por el proxy inverso y que est√° llegando al servidor web y que vuelve por el mismo camino. </p>
<p>Si record√°is de teor√≠a, el servidor web es capaz de a√±adir cabeceras en las respuestas a las peticiones. </p>
<p>As√≠ pues, vamos a configurar tanto el proxy inverso como el servidor web para que a√±adan cada uno la cabecera ‚ÄúHost‚Äù que tambi√©n vimos en teor√≠a. </p>
<p>Para a√±adir cabeceras, en el archivo de configuraci√≥n del sitio web debemos a√±adir dentro del bloque <code>location / { ‚Ä¶ }</code> debemos a√±adir la directiva: </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nb">add_header</span><span class="w"> </span>Host<span class="w"> </span>nombre_del_host;
</code></pre></div>
<ol>
<li>
<p>A√±adiremos primero esta cabecera √∫nicamente en el archivo de configuraci√≥n del sitio web del proxy inverso. El Nombre_del_host ser√° Proxy_inverso_vuestronombre. </p>
</li>
<li>
<p>Reiniciamos Nginx </p>
</li>
<li>
<p>Comprobamos que podemos acceder al sitio web sin problemas </p>
</li>
<li>
<p>Con las herramientas de desarrollador comprobamos que la petici√≥n ha pasado por el proxy inverso que ha a√±adido la cabecera en la respuesta: </p>
<p><img alt="" src="../../img/4.1-11.png" /></p>
</li>
<li>
<p>Hacemos lo propio con el servidor web. Esta vez el <code>Nombre_del_host</code> ser√° <code>servidor_web_vuestronombre</code>. </p>
<p>Si todo est√° configurado correctamente, al examinar las peticiones y respuestas, os aparecer√°n las dos cabeceras que han incluido en la respuesta tanto el proxy inverso como el servidor web. .</p>
<p><img alt="" src="../../img/4.1-12.png" /></p>
</li>
</ol>
<p>Es muy importante que para realizar estas comprobaciones teng√°is marcado el checkbox <em>Desactivar cach√©</em> o en <u>una ventana privada del navegador.</u></p>
<p><img alt="" src="../../img/4.1-13.png" /></p>
<p>Si no marc√°is esto, la p√°gina se guardar√° en la memoria cach√© del navegador y no estar√©is recibiendo la respuesta del servidor sino de la cach√© del navegador, lo que puede dar lugar a resultados err√≥neos. </p>
<h2 id="evaluacion">Evaluaci√≥n</h2>
<table>
<thead>
<tr>
<th style="text-align: left;">Criterio</th>
<th style="text-align: center;">Puntuaci√≥n</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Configuraci√≥n correcta y completa del servidor web</td>
<td style="text-align: center;"><strong>3 puntos</strong></td>
</tr>
<tr>
<td style="text-align: left;">Configuraci√≥n correcta y completa del proxy inverso</td>
<td style="text-align: center;"><strong>4 puntos</strong></td>
</tr>
<tr>
<td style="text-align: left;">Comprobaci√≥n del correcto funcionamento, incluyendo las cabeceras</td>
<td style="text-align: center;"><strong>1 puntos</strong></td>
</tr>
<tr>
<td style="text-align: left;">Se ha prestado especial atenci√≥n al formato del documento, utilizando la plantilla actualizada y haciendo un correcto uso del lenguaje t√©cnico</td>
<td style="text-align: center;"><strong>2 puntos</strong></td>
</tr>
</tbody>
</table>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.top", "toc.integrate", "search.highlight", "content.code.annotate", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>