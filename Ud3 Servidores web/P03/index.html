
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://laura-agut.github.io/Despliegue/Ud3%20Servidores%20web/P03/">
      
      
        <link rel="prev" href="../P02/">
      
      
        <link rel="next" href="../P04/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>Práctica 3.3 – Autenticación - Despliegue de aplicaciones web</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#practica-33-autenticacion" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="Despliegue de aplicaciones web" class="md-header__button md-logo" aria-label="Despliegue de aplicaciones web" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Despliegue de aplicaciones web
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Práctica 3.3 – Autenticación
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="Cambiar a modo oscuro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo oscuro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Cambiar a modo claro"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo claro" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Despliegue de aplicaciones web" class="md-nav__button md-logo" aria-label="Despliegue de aplicaciones web" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Despliegue de aplicaciones web
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Despliegue de aplicaciones web
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Ud0 Introduccion
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Ud0 Introduccion
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/Ud0_1Introalmodulo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.1. Introducción al módulo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/Ud0_2AWS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.2. Introducción a AWS Academy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/ejercicio-final-ebs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    🧪 Ejercicio final: modifica, prueba en local y despliega en Elastic Beanstalk
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Prácticas
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Prácticas
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.1. Linux Server en AWSAcademy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.2 Windows Server en AWSAcademy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.3. Conceder acceso a un segundo administrador
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.4. Comandos básicos Linux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.5: Despliegue Java en AWS Elastic Beanstalk
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="practica-33-autenticacion">Práctica 3.3 – Autenticación</h1>
<h2 id="autenticacion-en-nginx">Autenticación en Nginx</h2>
<p>Requisitos antes de comenzar la práctica</p>
<div class="admonition danger">
<p class="admonition-title">Atención, muy importante antes de empezar</p>
<ul>
<li>La práctica de creación de sitios virtuales en Nginx ha de estar funcionando correctamente</li>
<li>No empezar la práctica antes de tener esa práctica <strong><em>funcionando y comprobada</em></strong></li>
</ul>
</div>
<p>En el contexto de una transacción HTTP, la autenticación de <strong>acceso básica</strong> es un método diseñado para permitir a un navegador web, u otro programa cliente, proveer credenciales en la forma de usuario y contraseña cuando se le solicita una página al servidor. </p>
<p>La autenticación básica, como su nombre lo indica, es la forma más básica de autenticación disponible para las aplicaciones Web. Fue definida por primera vez en la especificación HTTP en sí y no es de ninguna manera elegante, pero cumple su función. Más adelante en este curso ya veremos otras formas de autenticación, como el uso de un servidor LDAP.</p>
<p>Este tipo de autenticación es el tipo más simple disponible pero adolece de importantes problemas de seguridad que no la hacen recomendable en muchas situaciones. No requiere el uso ni de cookies, ni de identificadores de sesión, ni de página de ingreso. </p>
<h3 id="preparando-el-entorno">Preparando el entorno</h3>
<p>En esta práctica vamos a proveer de autenticación a una página web completa o a una parte de ella. Para ello necesitaremos una página web con varias partes creada en nuestro servidor. </p>
<p>Partiremos del estado de la práctica anterior y trabajaremos sobre el sitio web "sitio1", que recuerda se encuetra en <code>/var/www/sitio1</code> y que pertenece a "usuario1". Por tanto, entra como "usuario1" antes de hacer los pasos siguientes.</p>
<p>Crea junto a tu fichero <code>index.html</code> un directorio nuevo y llámale <code>intranet</code>. Dentro haz una copia de <code>index.html</code> y modifica el contenido del encabezado &lt; h1 &gt; para que diga "Intranet".</p>
<p>Ya puedes dejar de trabajar con "usuario1" y volver a ser usuario administrador.</p>
<p>Accede desde el navegador de tu equipo a la nueva página y comprueba que accedes correctamente.</p>
<p><code>http://sitio1/intranet</code></p>
<div class="admonition atención">
<p class="admonition-title">Atención</p>
<p>Recuerda que habrás de modificar el fichero <code>/etc/hosts</code> en Linux o en Windows <code>C:\Windows\System32\drivers\etc\hosts</code> del equipo en el que estés usando el navegador.
O también puedes lanzar chrome con el comando: <code>google-chrome --host-resolver-rules="MAP sitio1 IPSERVER" --ignore-certificate-error</code></p>
</div>
<h3 id="creando-el-fichero-de-passwords">Creando el fichero de passwords</h3>
<p>Para esta práctica podemos utilizar la herramienta <code>htpasswd</code> para crear las contraseñas. Dicha herramienta se encuentra en el paquete <code>apache2-utils</code> así que lo primero será instalarlo</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>apache2-utils
</code></pre></div>
<p>Crearemos un archivo oculto llamado “.htpasswd” en el directorio de configuración <code>/etc/nginx</code> donde guardar nuestros usuarios y contraseñas (la -c es para crear el archivo) e incluiremos es primer usuario y contraseña para el usuario "profe": </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>sudo<span class="w"> </span>htpasswd<span class="w"> </span>-c<span class="w"> </span>/etc/nginx/.htpasswd<span class="w"> </span>profe
</code></pre></div>
<p>Te pedirá introducir la contraseña y repetirla. Ponle también "profe" para no olvidarla.</p>
<p>Comprueba la existencia y contenido del archivo creado.</p>
<p>Para el resto de usuarios usaremos la misma orden, pero sin "-c" ya que el fichero ya existirá.  </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>sudo<span class="w"> </span>htpasswd<span class="w"> </span>/etc/nginx/.htpasswd<span class="w"> </span>otro_usuario
</code></pre></div>
<ul>
<li>Crea dos usuarios, uno con tu nombre y otro con tu primer apellido</li>
<li>Comprueba que el usuario y la contraseña aparecen cifrados en el fichero: </li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>cat<span class="w"> </span>/etc/nginx/.htpasswd
</code></pre></div>
<h3 id="configurando-el-servidor-nginx-para-usar-autenticacion-basica">Configurando el servidor Nginx para usar autenticación básica</h3>
<p>Inicialmente vamos a hacer que se requiera autenticación para acceder a toda la página web "sitio1"</p>
<p>Editaremos la configuración del server block sobre el cual queremos aplicar la restricción de acceso. Utilizaremos para esta autenticación el sitio web de <em>sitio1</em>:  </p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Recuerda que un <em>server block</em> es cada uno de los dominios (<code>server {...}</code> dentro del archivo de configuración de alguno de los sitios web que hay en el servidor.</p>
</div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>sudo<span class="w"> </span>nano<span class="w"> </span>/etc/nginx/sites-available/sitio1
</code></pre></div>
<p>Debemos decidir qué recursos estarán protegidos. Nginx permite añadir restricciones a nivel de servidor o en un location (directorio o archivo) específico. Para nuestro ejemplo, vamos a proteger el root (la raíz, la página principal) de nuestro sitio. </p>
<p>Utilizaremos la directiva <code>auth_basic</code> dentro del location y le pondremos el nombre a nuestro dominio que será mostrado al usuario al solicitar las credenciales. Por último, configuramos Nginx para que utilice el fichero que previamente hemos creado con la directiva <code>auth_basic_user_file</code> : </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nb">server</span><span class="w"> </span>{
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">        </span><span class="nb">listen</span><span class="w"> </span><span class="m">80</span>;
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">        </span><span class="nb">listen</span><span class="w"> </span>[::]:80;
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">        </span><span class="nb">root</span><span class="w"> </span><span class="sx">/var/www/sitio1</span>;
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">        </span><span class="nb">index</span><span class="w"> </span>index.html<span class="w"> </span>index.htm<span class="w"> </span>index.nginx-debian.html;
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">        </span><span class="nb">server_name</span><span class="w"> </span>sitio1;
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">        </span><span class="nb">location</span><span class="w"> </span>/<span class="w"> </span>{
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="hll"><span class="w">            </span><span class="nb">auth_basic</span><span class="w">  </span><span class="s2">&quot;Área restringida&quot;</span>;
</span><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="hll"><span class="w">            </span><span class="nb">auth_basic_user_file</span><span class="w">    </span><span class="sx">/etc/nginx/.htpasswd</span>;
</span><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">            </span><span class="nb">try_files</span><span class="w"> </span>$uri<span class="w"> </span>$uri/<span class="w"> </span>=404;
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">        </span><span class="err">}</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="err">}</span>
</code></pre></div>
<p>Una vez terminada la configuración, reiniciamos el servicio para que aplique nuestra política de acceso. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>nginx
</code></pre></div>
<h3 id="probando-la-nueva-configuracion">Probando la nueva configuración</h3>
<div class="admonition warning">
<p class="admonition-title">Cuidado</p>
<p>Si usáis el mismo navegador que antes de activar la autenticación de sitio1, es muy probable que no os pida autenticaros porque os mostrará la página en caché local.</p>
<p>Igualmente, una vez os autenticáis con éxito, el navegador guardará esta autencación exitosa y no volverá a pediros <em>usuario/contraseña</em>. </p>
<p>Así pues, para cada prueba, si queréis volver a probar a autenticaros, tendréis que abriros una <strong>Nueva ventana privada</strong> o <strong>Nueva ventana de incógnito</strong> del navegador.</p>
</div>
<p>Realiza las siguientes pruebas:</p>
<div class="admonition cuestion">
<p class="admonition-title">Comprobación 1</p>
<p>Comprueba desde tu máquina física/anfitrión que puedes acceder a <code>http://sitio1</code> y que se te solicita autenticación</p>
</div>
<div class="admonition cuestión">
<p class="admonition-title">Comprobación 2</p>
<p>Comprueba que si decides cancelar la autenticación, se te negará el acceso al sitio con un error. ¿Qué error es?</p>
</div>
<div class="admonition cuestión">
<p class="admonition-title">Comprobación 3</p>
<p>Comprueba desde tu máquina física/anfitrión que ocurre al intentar acceder a <code>http://sitio1/page2.html</code> y <code>http://sitio1/page3.html</code>. Recuerda, inténtalo cada vez en una ventana de incógnito nueva</p>
</div>
<h3 id="tareas">Tareas</h3>
<div class="admonition question">
<p class="admonition-title">Tarea 1</p>
<ul>
<li>
<p>Intenta entrar primero con un usuario erróneo y luego con otro correcto. Puedes ver todos los sucesos y registros en los logs access.log y error.log </p>
</li>
<li>
<p>Comprueba los logs donde se vea que intentas entrar primero con un usuario inválido y con otro válido. Busca dónde podemos ver los errores de usuario inválido o no encontrado, así como donde podemos ver el número de error que os aparecía antes</p>
</li>
</ul>
</div>
<h3 id="autenticacion-de-una-parte-de-la-web">Autenticación de una parte de la web</h3>
<p>Cuando hemos configurado el siguiente bloque: </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="w">    </span><span class="nb">location</span><span class="w"> </span>/<span class="w"> </span>{
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="hll"><span class="w">        </span><span class="nb">auth_basic</span><span class="w">  </span><span class="s2">&quot;Área restringida&quot;</span>;
</span><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="hll"><span class="w">        </span><span class="nb">auth_basic_user_file</span><span class="w">    </span><span class="sx">/etc/nginx/.htpasswd</span>;
</span><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">        </span><span class="nb">try_files</span><span class="w"> </span>$uri<span class="w"> </span>$uri/<span class="w"> </span>=404;
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">    </span><span class="err">}</span>
</code></pre></div>
<p>La autenticación se aplica al directorio o archivo que le indicamos en la declaración del <code>location</code> y que en este caso el raíz <code>/</code>.</p>
<p>Así pues, esta restricción se aplica al directorio raíz o base donde residen los archivos del sitio web y que es: </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>/var/www/sitio1
</code></pre></div>
<p>Y a todos los archivos que hay dentro, ya que no hemos especificado ninguno en concreto. </p>
<p>Ahora bien, vamos a probar a aplicar la autenticación solo a una parte de la web, en este caso a "intranet". </p>
<div class="admonition question">
<p class="admonition-title">Tarea 2</p>
<p>Borra las dos líneas que hacen referencia a la autenticación básica en el location del directorio raíz. Tras ello, añade un nuevo location debajo con la autenticación básica para el directorio <code>/intranet</code> únicamente. </p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Fijáos que debéis tener cuidado porque la última línea del archivo ha de ser <code>}</code> que cierra la primera línea <code>server {</code> del archivo.</p>
</div>
<p>Comprueba ahora que si accedes a la página principal no te solicita autenticación, pero si intentas acceder a la "intranet" si te la solicita.</p>
<h3 id="combinacion-de-la-autenticacion-basica-con-la-restriccion-de-acceso-por-ip">Combinación de la autenticación básica con la restricción de acceso por IP</h3>
<p>La autenticación básica HTTP puede ser combinada de forma efectiva con la restricción de acceso por dirección IP. Se pueden implementar dos escenarios: </p>
<ul>
<li>
<p>Un usuario debe estar ambas cosas, autenticado y tener una IP válida</p>
</li>
<li>
<p>Un usuario debe o bien estar autenticado, o bien tener una IP válida </p>
</li>
</ul>
<p>Veamos cómo lo haríamos:</p>
<ol>
<li>
<p>Como permitir o denegar acceso sobre una IP concreta (directivas <strong>allow</strong> y <strong>deny</strong>, respectivamente). Dentro del block server o archivo de configuración del dominio web, que recordad está en el directorio sites-available: </p>
<p><img alt="" src="../../img/4.1-5.png" /></p>
<p>El acceso se garantizará ala IP <code>192.168.1.1/24</code>, excluyendo a la dirección <code>192.168.1.2</code>.</p>
<p>Hay que tener en cuenta que las directivas allow y deny se irán aplicando en el orden en el que aparecen el archivo.</p>
<p>Aquí aplican sobre la <code>location /api</code> (esto es sólo un ejemplo de un hipotético directorio o archivo), pero podrían aplicar sobre cualquiera, incluida todo el sitio web, la location raíz <code>/</code>.</p>
<p>La última directiva <code>deny all</code> quiere decir que por defecto denegaremos el acceso a todo el mundo. Por eso hay que poner los allow y deny más específicos justo antes de esta, porque al evaluarse en orden de aparición, si los pusiéramos debajo se denegaría el acceso a todo el mundo, puesto que <code>deny all</code> sería lo primero que se evaluaría. </p>
</li>
<li>
<p>Combinar la restricción IP y la autenticación HTTP con la directiva <strong>satisfy</strong>. </p>
<p>Si establecemos el valor de la directiva a “all”, el acceso se permite si el cliente satisface ambas condiciones (IP y usario válido). Si lo establecemos a “any”, el acceso se permite si se satisface al menos una de las dos condiciones.</p>
<p><img alt="" src="../../img/4.1-6.png" /></p>
</li>
</ol>
<p>Vamos a probar lo anterior. Para ello deberermos obtener, en primer lugar, la IP desde la que le llegan las peticiones a nuestro servidor nginx cuando pedimos una página web. Lo puedes obtener desde el archivo le log de nginx</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>tail -n 3 /var/log/nginx/access.log
</code></pre></div>
<p>Una vez obtenida la IP, puedes hacer las tareas siguientes</p>
<h3 id="tareas-y-cuestiones-finales">Tareas y cuestiones finales</h3>
<div class="admonition question">
<p class="admonition-title">Tarea 1</p>
<p>Configura Nginx para que no deje acceder con la IP de la máquina anfitriona al directorio <code>intranet</code>. Modifica su server block o archivo de configuración. Comprueba como se deniega el acceso.</p>
</div>
<ul>
<li>
<p>Muestra la página de error en el navegador </p>
</li>
<li>
<p>Muestra el mensaje de error de error.log </p>
</li>
</ul>
<div class="admonition question">
<p class="admonition-title">Tarea 2</p>
<p>Configura Nginx para solo se pueda acceder a <code>intranet</code> desde tu máquina anfitriona y se tenga que tener tanto una IP válida como un usuario válido, ambas cosas a la vez, y comprueba que sí puede acceder sin problemas.</p>
</div>
<p>Responde a las siguientes cuestiones.</p>
<div class="admonition task">
<p class="admonition-title">Cuestión 1</p>
<p>Supongamos que yo soy el cliente con la IP 172.1.10.15 e intento acceder al directorio <code>web_muy_guay</code> de mi sitio web, equivocándome al poner el usuario y contraseña. ¿Podré acceder? ¿Por qué?</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="w">    </span><span class="nb">location</span><span class="w"> </span><span class="sx">/web_muy_guay</span><span class="w"> </span>{
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span><span class="c">#...</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="nb">satisfy</span><span class="w"> </span><span class="k">all</span>;<span class="w">    </span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">    </span><span class="nb">deny</span><span class="w">  </span><span class="m">172.1.10.6</span>;
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">    </span><span class="nb">allow</span><span class="w"> </span><span class="m">172.1.10.15</span>;
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">    </span><span class="nb">allow</span><span class="w"> </span><span class="m">172.1.3.14</span>;
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">    </span><span class="nb">deny</span><span class="w">  </span><span class="k">all</span>;
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">    </span><span class="nb">auth_basic</span><span class="w"> </span><span class="s2">&quot;Cuestión final 1&quot;</span>;
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">    </span><span class="nb">auth_basic_user_file</span><span class="w"> </span>conf/htpasswd;
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="err">}</span>
</code></pre></div>
</div>
<div class="admonition task">
<p class="admonition-title">Cuestión 2</p>
<p>ask "Cuestión 1"
Supongamos que yo soy el cliente con la IP 172.1.10.15 e intento acceder al directorio <code>web_muy_guay</code> de mi sitio web, introduciendo correctamente usuario y contraseña. ¿Podré acceder?¿Por qué?</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="w">    </span><span class="nb">location</span><span class="w"> </span><span class="sx">/web_muy_guay</span><span class="w"> </span>{
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">    </span><span class="c">#...</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">    </span><span class="nb">satisfy</span><span class="w"> </span><span class="k">all</span>;<span class="w">    </span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">    </span><span class="nb">deny</span><span class="w">  </span><span class="k">all</span>;
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">    </span><span class="nb">deny</span><span class="w">  </span><span class="m">172.1.10.6</span>;
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">    </span><span class="nb">allow</span><span class="w"> </span><span class="m">172.1.10.15</span>;
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">    </span><span class="nb">allow</span><span class="w"> </span><span class="m">172.1.3.14</span>;
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">    </span><span class="nb">auth_basic</span><span class="w"> </span><span class="s2">&quot;Cuestión final 2: The revenge&quot;</span>;
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">    </span><span class="nb">auth_basic_user_file</span><span class="w"> </span>conf/htpasswd;
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="err">}</span>
</code></pre></div>
</div>
<div class="admonition task">
<p class="admonition-title">Cuestión 3</p>
<p>Supongamos que yo soy el cliente con la IP 172.1.10.15 e intento acceder al directorio <code>web_muy_guay</code> de mi sitio web, introduciendo correctamente usuario y contraseña. ¿Podré acceder?¿Por qué?</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="w">    </span><span class="nb">location</span><span class="w"> </span><span class="sx">/web_muy_guay</span><span class="w"> </span>{
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">    </span><span class="c">#...</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="nb">satisfy</span><span class="w"> </span><span class="k">any</span>;<span class="w">    </span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">    </span><span class="nb">deny</span><span class="w">  </span><span class="m">172.1.10.6</span>;
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">    </span><span class="nb">deny</span><span class="w"> </span><span class="m">172.1.10.15</span>;
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">    </span><span class="nb">allow</span><span class="w"> </span><span class="m">172.1.3.14</span>;
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">    </span><span class="nb">auth_basic</span><span class="w"> </span><span class="s2">&quot;Cuestión final 3: The final combat&quot;</span>;
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">    </span><span class="nb">auth_basic_user_file</span><span class="w"> </span>conf/htpasswd;
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="err">}</span>
</code></pre></div>
</div>
<div class="admonition task">
<p class="admonition-title">Cuestión 4</p>
<p>A lo mejor no sabéis que tengo una web para documentar todas mis excursiones espaciales con Jeff, es esta: <a href="https://freewebsitetemplates.com/preview/space-science/index.html">Jeff Bezos y yo</a></p>
<p>Supongamos que quiero restringir el acceso al directorio de proyectos porque es muy secreto, eso quiere decir añadir autenticación básica a la URL:<a href="https://freewebsitetemplates.com/preview/space-science/projects.html">Proyectos</a></p>
<p>Completa la configuración para conseguirlo:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="w">    </span><span class="nb">server</span><span class="w"> </span>{
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">        </span><span class="nb">listen</span><span class="w"> </span><span class="m">80</span>;
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">        </span><span class="nb">listen</span><span class="w"> </span>[::]:80;
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">        </span><span class="nb">root</span><span class="w"> </span><span class="sx">/var/www/freewebsitetemplates.com/preview/space-science</span>;
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">        </span><span class="nb">index</span><span class="w"> </span>index.html<span class="w"> </span>index.htm<span class="w"> </span>index.nginx-debian.html;
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">        </span><span class="nb">server_name</span><span class="w"> </span>freewebsitetemplates.com<span class="w"> </span>www.freewebsitetemplates.com;
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="hll"><span class="w">        </span><span class="nb">location</span><span class="w">              </span>{
</span><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="hll">
</span><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">            </span><span class="nb">try_files</span><span class="w"> </span>$uri<span class="w"> </span>$uri/<span class="w"> </span>=404;
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">        </span><span class="err">}</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="w">    </span><span class="err">}</span>
</code></pre></div>
</div>
<h2 id="autenticacion-en-apache2">Autenticación en Apache2</h2>
<p>La gran mayoría de servidores web permiten la instalación de módulos para ampliar sus funcionalidades. Tener funcionalidades en forma de módulo permite adaptar mejor el consumo de recursos del servidor web a nuestras necesidades (el servidor web solo cargará y ejecutará los módulos que como administradores tenemos instalados y configurados).</p>
<p>El servidor web Apache HTTP Server permite añadir funcionalidades adicionales a las que nos ofrece su configuración básica en forma de módulos instalables. La autenticación es una de dichas funcionalidades. Veamos cómo aplicar una autenticación básica equivalente a la que usamos anteriormente en Ngnix.</p>
<p>Recuperaremos nuestra EC2 en AWS que denominamos "servidorApache" y en la que configuramos 2 sitios virtuales. </p>
<p>En primer lugar vamos a crear el directorio "intranet" en "sitio1" con un fichero index.html en su interior. Comprobaremos su buen funcionamiento.</p>
<p>Y a continuación crearemos el fichero htpasswd como hicimos anteriormente para Nginx y crearemos el usuario "profe" con password "profe". Ten en cuenta que ahora la ruta del fichero debe cambiar.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>sudo<span class="w"> </span>htpasswd<span class="w"> </span>-c<span class="w"> </span>/etc/apache2/.htpasswd<span class="w"> </span>profe
</code></pre></div>
<p>Ahora vamos a configurar las directivas en el fichero de configuración del sitio1: <code>ls /etc/apache2/sites-available/sitio1.conf</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nt">&lt;VirtualHost</span><span class="w"> </span><span class="s">*:80</span><span class="nt">&gt;</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">        </span><span class="nb">ServerName</span><span class="w"> </span>sitio1
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">        </span><span class="nb">DocumentRoot</span><span class="w"> </span><span class="sx">/var/www/sitio1</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">        </span><span class="nt">&lt;Directory</span><span class="w"> </span><span class="s">/var/www/sitio1</span><span class="nt">&gt;</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">                </span><span class="nb">AllowOverride</span><span class="w"> </span><span class="k">All</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">                </span><span class="nb">Require</span><span class="w"> </span><span class="k">all</span><span class="w"> </span>granted
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">        </span><span class="nt">&lt;/Directory&gt;</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="hll"><span class="w">        </span><span class="nt">&lt;Directory</span><span class="w"> </span><span class="s">/var/www/sitio1/intranet</span><span class="nt">&gt;</span>
</span><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="hll"><span class="w">                </span><span class="nb">AuthType</span><span class="w"> </span>Basic
</span><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="hll"><span class="w">                </span><span class="nb">AuthName</span><span class="w"> </span><span class="s2">&quot;Intranet&quot;</span>
</span><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="hll"><span class="w">                </span><span class="nb">AuthBasicProvider</span><span class="w"> </span>file
</span><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="hll"><span class="w">                </span><span class="nb">AuthUserFile</span><span class="w"> </span><span class="sx">/etc/apache2/.htpasswd</span>
</span><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="hll"><span class="w">                </span><span class="nb">Require</span><span class="w"> </span>valid-user
</span><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="hll"><span class="w">        </span><span class="nt">&lt;/Directory&gt;</span>
</span><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="nt">&lt;/VirtualHost&gt;</span>
</code></pre></div>
<p>Veamos las directivas aplicadas:</p>
<ul>
<li>
<p><strong>AuthType</strong>: indica que el tipo de autenticación es básica (en lugar de digest que implica comunicaciones cifradas).</p>
</li>
<li>
<p><strong>AuthName</strong>: declara el "reialme" al cual pertenece el recurso restringido. Esto permite que si hay otros recursos restringidos asociados a este "reialme" el usuario que ya se ha autenticado en uno de ellos no lo tenga que hacer en los otros. El nombre del reino lo pone el administrador web.</p>
</li>
<li>
<p><strong>AuthBasicProvider</strong>: indica el método de autenticación que se tiene que usar. Puede tomar valores tipos ldap, pam, dbm, bdb, file y otros. El valor file significa que se utilizará un fichero de usuarios.</p>
</li>
<li>
<p><strong>AuthUserFile</strong>: indica cuál es el fichero que contiene las cuentas de los usuarios locales del servidor Apache. Es el fichero que hemos creado con los usuarios.</p>
</li>
<li>
<p><strong>Require</strong>: esta directiva es la que determina cuál es la autorización que se tiene que hacer. En el ejemplo se permitirá el acceso a los usuarios presentes en el fichero .htpasswd.</p>
</li>
</ul>
<p>Vamos a reiniciar el servicio y comprobar que funciona la restricción de acceso aplicada.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>sudo systemctl restart apache2
</code></pre></div>
<p>Probablemente no has tenido que hacer nada más porque los módulos de autenticación de apache están activados por defecto. Como dijimos antes Apache usa módulos para poder activar y desactivar funcionalidades. La instalación de los módulos se hace mediante ficheros guardados en 2 directorios:</p>
<ul>
<li><code>/etc/apache2/mods-available/</code>. Tiene 1 ó 2 ficheros por módulo<ul>
<li>Fichero .load - Contiene la directiva para cargar el módulo</li>
<li>Fichero . conf - Contiene las directivas de configuración del módulo (no todos los módulos lo tienen)</li>
</ul>
</li>
<li><code>/etc/apache2/mods-enabled/</code>. Los módulos se activan mediante un enlace simbólico en esta carpeta a cada uno de los ficheros en la carpeta <code>/etc/apache2/mods-available/</code></li>
</ul>
<p>Comprueba ambas carpetas y cómo hay muchos más módulos disponibles que activados:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>ls -la /etc/apache2/mods-available/
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>ls -la /etc/apache2/mods-enabled/
</code></pre></div>
¿Y cuáles son los módulos que permiten la autenticación que hemos usado? Usamos 3 módulos, cada uno de los cuales tiene una funcionalidad</p>
<ul>
<li><strong>Tipo de autenticación</strong>: Puede ser "basic" o "digest". Los módulos son <strong>auth_basic</strong> y <strong>auth_digest</strong>. Comprueba cómo ambos módulos están instalados (están presentes en <code>/etc/apache2/mods-available/</code>) pero solo la básica está activada (existe el enlace simbólico en <code>/etc/apache2/mods-enabled/</code>)</li>
<li><strong>Proveedor de autenticación</strong>: indica cuál es el mecanismos parar autenticar usuarios. Puede ser un fichero local <strong>authn_file</strong> o LDAP <strong>authnz_ldap</strong> entre otros.Comprueba nuevamente cuál está activada y cuál no.</li>
<li><strong>Autorización</strong>: indica si la autorización de acceso a los recursos se hace a nivel de usuarios <strong>authz_user</strong>, ldap <strong>authz_ldap</strong>, etc</li>
</ul>
<p>Para activar y desactivar módulos se usan unos comandos que se encargan de crear o eliminar los enlaces simbólicos. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>a2enmod *modulo*
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>a2dismod *modulo*
</code></pre></div>
<p>Así, si alguno de los módulos anteriores no estuvieran activos los podríamos activar con:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>a2enmod auth_basic
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>a2enmod authn_file
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>a2enmod authz_user
</code></pre></div>
<p>Recuerda que después de cada activación deberíamos reinicial el servidor con:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>sudo systemctl restart apache2
</code></pre></div>
<h2 id="dockerizacion">Dockerización</h2>
<p>Para dockerizar un servidor Nginx o Apache2 con autenticación usaríamos las mismas estrategias que ya conocemos y que vimos en las prácticas de instalación y creación de servidores virtuales.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.top", "toc.integrate", "search.highlight", "content.code.annotate", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>