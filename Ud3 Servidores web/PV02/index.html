
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://laura-agut.github.io/Despliegue/Ud3%20Servidores%20web/PV02/">
      
      
        <link rel="prev" href="../PV01/">
      
      
        <link rel="next" href="../PV03/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>Pr√°ctica Voluntaria 3.2 ‚Äì Balanceo de carga con proxy inverso en Nginx - Despliegue de aplicaciones web</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#practica-voluntaria-32-balanceo-de-carga-con-proxy-inverso-en-nginx" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="Despliegue de aplicaciones web" class="md-header__button md-logo" aria-label="Despliegue de aplicaciones web" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Despliegue de aplicaciones web
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Pr√°ctica Voluntaria 3.2 ‚Äì Balanceo de carga con proxy inverso en Nginx
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="Cambiar a modo oscuro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo oscuro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Cambiar a modo claro"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo claro" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="B√∫squeda" placeholder="B√∫squeda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando b√∫squeda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegaci√≥n" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Despliegue de aplicaciones web" class="md-nav__button md-logo" aria-label="Despliegue de aplicaciones web" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Despliegue de aplicaciones web
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Despliegue de aplicaciones web
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Ud0 Introduccion
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Ud0 Introduccion
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/Ud0_1Introalmodulo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.1. Introducci√≥n al m√≥dulo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/Ud0_2AWS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.2. Introducci√≥n a AWS Academy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/ejercicio-final-ebs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    üß™ Ejercicio final: modifica, prueba en local y despliega en Elastic Beanstalk
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pr√°cticas
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Pr√°cticas
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.1. Linux Server en AWSAcademy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.2 Windows Server en AWSAcademy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.3. Conceder acceso a un segundo administrador
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.4. Comandos b√°sicos Linux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.5: Despliegue Java en AWS Elastic Beanstalk
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="practica-voluntaria-32-balanceo-de-carga-con-proxy-inverso-en-nginx">Pr√°ctica Voluntaria 3.2 ‚Äì Balanceo de carga con proxy inverso en Nginx</h1>
<h2 id="requisitos-aantes-de-comenzar-la-practica">Requisitos aantes de comenzar la pr√°ctica</h2>
<div class="admonition danger">
<p class="admonition-title">Atenci√≥n, muy importante antes de empezar</p>
<ul>
<li>La pr√°ctica 2.3 debe estar funcionando correctamente</li>
<li>No empezar la pr√°ctica antes de tener la 2.3 funcionando y <strong><em>comprobada</em></strong> </li>
</ul>
</div>
<h2 id="introduccion">Introducci√≥n</h2>
<p>Los servidores proxy inversos y los balanceadores de carga son componentes de una arquitectura inform√°tica cliente-servidor. Ambos act√∫an como intermediarios en la comunicaci√≥n entre los clientes y los servidores, realizando funciones que mejoran la eficiencia. </p>
<p>Las definiciones b√°sicas son simples: </p>
<ul>
<li>
<p>Un <a href="https://www-nginx-com.translate.goog/resources/glossary/reverse-proxy-server?_x_tr_sl=en&amp;_x_tr_tl=es&amp;_x_tr_hl=es">proxy inverso</a>     acepta una solicitud de un cliente, la reenv√≠a a un servidor que puede cumplirla y devuelve la respuesta del servidor al cliente.  </p>
</li>
<li>
<p>Un <a href="https://www-nginx-com.translate.goog/resources/glossary/load-balancing?_x_tr_sl=en&amp;_x_tr_tl=es&amp;_x_tr_hl=es">balanceador de carga</a>     distribuye las solicitudes entrantes del cliente entre un grupo de servidores, en cada caso devolviendo la respuesta del servidor seleccionado al cliente apropiado. </p>
</li>
</ul>
<p>Suenan bastante similares, ¬øverdad? Ambos tipos de aplicaciones se ubican entre clientes y servidores, aceptando solicitudes del primero y entregando respuestas del segundo. No es de extra√±ar que haya confusi√≥n sobre qu√© es un proxy inverso y un balanceador de carga. Para ayudar a diferenciarlos, exploremos cu√°ndo y por qu√© normalmente se implementan en un sitio web. .</p>
<h3 id="proxy-inverso">Proxy inverso</h3>
<p>Ya conocemos este concepto de la pr√°ctica anterior. </p>
<p>Mientras que implementar un balanceador de carga solo tiene sentido cuando se tienen varios servidores, a menudo tiene sentido implementar un proxy inverso incluso con un solo servidor web o servidor de aplicaciones. </p>
<p>Se puede pensar en el proxy inverso como la "cara p√∫blica" de un sitio web. Su direcci√≥n es la que se anuncia para el sitio web y se encuentra en la frontera de la red del sitio para aceptar solicitudes de navegadores web y aplicaciones m√≥viles para el contenido alojado en el sitio web. </p>
<h3 id="balanceadores-de-carga">Balanceadores de carga</h3>
<p>Los balanceadores de carga se implementan con mayor frecuencia cuando un sitio necesita varios servidores porque el volumen de solicitudes es demasiado para que un solo servidor lo maneje de manera eficiente. </p>
<p>La implementaci√≥n de varios servidores tambi√©n elimina un solo punto de fallo, lo que hace que el sitio web sea m√°s confiable. Por lo general, todos los servidores alojan el mismo contenido, y el trabajo del balanceador de carga es distribuir la carga de trabajo de  manera que se haga el mejor uso de la capacidad de cada servidor, evite la sobrecarga en cualquiera de ellos y d√© como resultado la respuesta m√°s r√°pida posible al cliente. . </p>
<p><u>Un balanceador de carga tambi√©n puede mejorar la experiencia del usuario al reducir la cantidad de respuestas de error que ve el cliente. Lo hace detectando cu√°ndo los servidores caen y desviando las solicitudes de ellos a los otros servidores del grupo</u>. En la implementaci√≥n m√°s simple, el balanceador de carga detecta el estado del servidor al interceptar las respuestas de error a las solicitudes regulares. </p>
<p>En esta pr√°ctica tendremos el escenario donde Nginx har√° tanto de proxy inverso como de balanceador de carga al mismo tiempo.  </p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>En esta pr√°ctica tendremos un escenario donde Nginx har√° tanto de proxy inverso como de balanceador de carga <u>al mismo tiempo</u></p>
</div>
<h2 id="tarea">Tarea</h2>
<p>Vamos a configurar dos servidores web Nginx con dos m√°quinas Debian, adem√°s de reutilizar el proxy inverso Nginx configurado en la pr√°ctica anterior. Partiremos por tanto de la configuraci√≥n de la pr√°ctica anterior, a√±adiendo lo necesario: </p>
<ul>
<li>
<p>Cada servidor web presentar√° un sitio web espec√≠fico para esta pr√°ctica </p>
<ul>
<li>El webserver2 debe tener la IP asignada de forma fija mediante la configuraci√≥n DHCP. </li>
</ul>
</li>
<li>
<p>El proxy inverso que ya ten√≠amos configurado, habr√° ahora que configurarlo para que realice el balanceo de carga que deseamos </p>
</li>
<li>
<p>Realizaremos las peticiones HTTP desde el navegador web de nuestra m√°quina anfitriona. </p>
</li>
</ul>
<p>El diagrama de red quedar√≠a as√≠: </p>
<p><img alt="" src="../../img/4.1-14.png" /></p>
<p>Haremos las peticiones web desde el navegador al proxy inverso, que las repartir√° entre los dos servidores web que tenemos. </p>
<p>Accederemos a <code>http://balanceo</code> y debemos observar que las peticiones, efectivamente, se van repartiendo entre el servidor 1 y el 2. </p>
<h3 id="configuraciones">Configuraciones</h3>
<div class="admonition danger">
<p class="admonition-title">Atenci√≥n</p>
<p>Ya no vamos a utilizar los sitios web que hemos configurado en las pr√°cticas anteriores. Por ello, para evitarnos una serie de problemas que pueden surgir, vamos a desactivarlos.</p>
<p>Dentro de la carpeta <code>/etc/nginx/sites-enabled</code> debemos ejecutar <code>unlink nombre_archivo</code> para cada uno de los archivos de los sitios web que tenemos.</p>
<p><u><strong>Si no hac√©is esto obtendr√©is errores en todas las pr√°cticas que quedan de este tema.</strong></u></p>
</div>
<h4 id="nginx-servidor-web-1">Nginx Servidor Web 1</h4>
<p>El primer servidor web ser√° el servidor principal que hemos venido utilizando hasta ahora durante el curso, el original, donde tenemos instalado ya el servicio Web. </p>
<p>Debemos configurar este servidor web para que sirva el siguiente <code>index.html</code> que deb√©is crear dentro de la carpeta <strong><code>/var/www/webserver1/html</code></strong>: </p>
<p><img alt="" src="../../img/4.1-15.png" /></p>
<ul>
<li>
<p>El nombre del sitio web que deb√©is utilizar en los archivos correspondientes (<em>sites-available</em>‚Ä¶) que deb√©is crear para Nginx es <code>webserver1</code>, as√≠ como en sus configuraciones. Fij√°os en las configuraciones que hicisteis en pr√°cticas anteriores a modo de referencia. </p>
</li>
<li>
<p>El sitio web debe escuchar en el puerto 8080. </p>
</li>
<li>
<p>Deb√©is a√±adir una cabecera que se llame <code>Serv_Web1_vuestronombre</code>. </p>
</li>
</ul>
<h4 id="nginx-servidor-web-2">Nginx Servidor Web 2</h4>
<p>Debe ser una m√°quina Debian, clon del servidor web 1. </p>
<p>En este servidor web debemos realizar una configuraci√≥n id√©ntica al servidor web 1 pero cambiando <code>webserver1</code> por <code>webserver2</code> (tambi√©n en el index.html), as√≠ como el nombre de la cabecera a√±adida, que ser√° <code>Serv_Web2_vuestronombre</code></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Es importante que no quede ninguna referencia a webserver1 por ning√∫n archivo, de otra forma os dar√° resultados err√≥neos y os dificultar√° mucho encontrar el error.</p>
</div>
<h4 id="nginx-proxy-inverso">Nginx Proxy Inverso</h4>
<p>Ya disponemos de los dos servidores web entre los que se van a repartir las peticiones que realice el cliente desde el navegador. </p>
<p>Vamos, por tanto, a configurar el proxy inverso para que realice este reparto de peticiones: </p>
<ul>
<li>En sites-available deb√©is crear el archivo de configuraci√≥n con el nombre <em>balanceo</em></li>
</ul>
<p>Este archivo tendr√° el siguiente formato:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="w">    </span><span class="nb">upstream</span><span class="w"> </span>backend_hosts<span class="w"> </span>{
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">                </span><span class="nb">random</span>;
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">                </span><span class="nb">server</span><span class="w"> </span>________:____;
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">                </span><span class="nb">server</span><span class="w"> </span>________:____;
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="err">}</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">            </span><span class="nb">server</span><span class="w"> </span>{
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">                </span><span class="nb">listen</span><span class="w"> </span><span class="m">80</span>;
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">                </span><span class="nb">server_name</span><span class="w"> </span>________;<span class="w">      </span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">                </span><span class="nb">location</span><span class="w"> </span>/<span class="w"> </span>{
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">                    </span><span class="nb">proxy_pass</span><span class="w"> </span>http://backend_hosts;
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">                </span><span class="err">}</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">            </span><span class="err">}</span>
</code></pre></div>
Donde: </p>
<ul>
<li>
<p>El bloque upstream ‚Üí son los servidores entre los que se va a repartir la carga, que son los dos que hemos configurado anteriormente. </p>
</li>
<li>
<p>Si mir√°is el diagrama y ten√©is en cuenta la configuraci√≥n que hab√©is hecho hasta ahora, aqu√≠ deber√©is colocar la IP de cada servidor, as√≠ como el puerto donde est√° escuchando las peticiones web. </p>
</li>
<li>
<p>A este grupo de servidores le ponemos un nombre, que es <code>backend_hosts</code></p>
</li>
</ul>
<div class="admonition quote">
<p class="admonition-title">Aclaraci√≥n</p>
<p>En un sitio web, el backend se encarga de todos los procesos necesarios para que la web funcione de forma correcta. Estos procesos o funciones no son visibles pero tienen mucha importancia en el buen funcionamiento de un sitio web.</p>
</div>
<ul>
<li>
<p>El par√°metro random lo que hace es repartir las peticiones HTTP que llegan al proxy inverso de forma completamente aleatoria entre el grupo de servidores que se haya definido en el bloque upstream (en nuestro caso s√≥lo hay dos). </p>
<ul>
<li>Pondremos random porque es lo m√°s f√°cil para comprobar que todo funciona bien en la pr√°ctica, pero hay diferentes formas de repartir la carga (las peticiones HTTP). </li>
</ul>
</li>
</ul>
<h2 id="comprobaciones">Comprobaciones</h2>
<p>Si acced√©is a vuestro sitio web, deb√©is poder seguir accediendo sin problemas. </p>
<ul>
<li>
<p>Comprobad d√°ndole repetidamente a F5, que acced√©is cada vez a uno de los servidores. Se os mostrar√° el contenido del index.html del servidor correspondiente cada vez. </p>
<ul>
<li>Para una doble comprobaci√≥n, utilizando las herramientas de desarrollador, mostrad que la web que se os muestra coincide con la cabecera que ha a√±adido el servidor web en la respuesta HTTP. </li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Recordatorio</p>
<p>Recordad que es muy importante que para realizar estas comprobaciones teng√°is marcado el checkbox <strong>Desactivar cach√©</strong>.  </p>
<p><img alt="" src="../../img/4.1-13.png" /></p>
<p>Si no marc√°is esto, la p√°gina se guardar√° en la memoria cach√© del navegador y no estar√©is recibiendo la respuesta del servidor sino de la cach√© del navegador, lo que puede dar lugar a resultados err√≥neos. </p>
<p>Otra opci√≥n, si esto no funcionara, es hacer las pruebas con una nueva ventana privada del navegador.</p>
</div>
<h3 id="comprobacion-del-balanceo-de-carga-cuando-cae-un-servidor">Comprobaci√≥n del balanceo de carga cuando cae un servidor</h3>
<p>Nuestro balanceador de carga est√° constantemente monitorizando ‚Äúla salud‚Äù de los servidores web. De esta forma, si uno deja de funcionar por cualquier raz√≥n, siempre enviar√° las solicitudes a los que queden ‚Äúvivos‚Äù. Vamos a comprobarlo: </p>
<ul>
<li>
<p>Para el servicio Nginx en el servidor web 1 y comprueba, de la misma forma que en el apartado anterior, que todas las solicitudes se env√≠an ahora al servidor web 2 </p>
</li>
<li>
<p>Tras iniciar de nuevo Nginx en el servidor web 1, repite el proceso con el servidor web 2.  </p>
</li>
</ul>
<h2 id="cuestiones-finales">Cuestiones finales</h2>
<div class="admonition task">
<p class="admonition-title">Cuesti√≥n 1</p>
<p>Busca informaci√≥n de qu√© otros m√©todos de balanceo se pueden aplicar con Nginx y describe al menos 3 de ellos.</p>
</div>
<div class="admonition task">
<p class="admonition-title">Cuesti√≥n 2</p>
<p>Si quiero a√±adir 2 servidores web m√°s al balanceo de carga, describe detalladamente qu√© configuraci√≥n habr√≠a que a√±adir y d√≥nde.</p>
</div>
<div class="admonition task">
<p class="admonition-title">Cuesti√≥n 3</p>
<p>Describe todos los pasos que deber√≠amos seguir y configurar para realizar el balanceo de carga con una de las webs de pr√°cticas anteriores.</p>
<p>Indicad la configuraci√≥n de todas las m√°quinas (webservers, proxy...) y de sus servicios</p>
</div>
<h2 id="evaluacion">Evaluaci√≥n</h2>
<table>
<thead>
<tr>
<th style="text-align: left;">Criterio</th>
<th style="text-align: center;">Puntuaci√≥n</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Configuraci√≥n correcta y completa del servidor web 1</td>
<td style="text-align: center;"><strong>2 puntos</strong></td>
</tr>
<tr>
<td style="text-align: left;">Configuraci√≥n correcta y completa del servidor web 2</td>
<td style="text-align: center;"><strong>2 puntos</strong></td>
</tr>
<tr>
<td style="text-align: left;">Configuraci√≥n correcta y completa del proxy inverso</td>
<td style="text-align: center;"><strong>3 puntos</strong></td>
</tr>
<tr>
<td style="text-align: left;">Cuestiones finales</td>
<td style="text-align: center;"><strong>1 puntos</strong></td>
</tr>
<tr>
<td style="text-align: left;">Se ha prestado especial atenci√≥n al formato del documento, utilizando la plantilla actualizada y haciendo un correcto uso del lenguaje t√©cnico</td>
<td style="text-align: center;"><strong>2 puntos</strong></td>
</tr>
</tbody>
</table>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.top", "toc.integrate", "search.highlight", "content.code.annotate", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>