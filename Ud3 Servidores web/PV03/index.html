
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://laura-agut.github.io/Despliegue/Ud3%20Servidores%20web/PV03/">
      
      
        <link rel="prev" href="../PV02/">
      
      
        <link rel="next" href="../T01/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>Practica Voluntaria 3.3 - Proxy inverso y balanceo de carga con SSL en NGINX - Despliegue de aplicaciones web</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#practica-voluntaria-33-proxy-inverso-y-balanceo-de-carga-con-ssl-en-nginx" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="Despliegue de aplicaciones web" class="md-header__button md-logo" aria-label="Despliegue de aplicaciones web" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Despliegue de aplicaciones web
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Practica Voluntaria 3.3 - Proxy inverso y balanceo de carga con SSL en NGINX
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="Cambiar a modo oscuro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo oscuro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Cambiar a modo claro"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo claro" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="B√∫squeda" placeholder="B√∫squeda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando b√∫squeda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegaci√≥n" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Despliegue de aplicaciones web" class="md-nav__button md-logo" aria-label="Despliegue de aplicaciones web" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Despliegue de aplicaciones web
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Despliegue de aplicaciones web
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Ud0 Introduccion
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Ud0 Introduccion
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/Ud0_1Introalmodulo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.1. Introducci√≥n al m√≥dulo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/Ud0_2AWS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.2. Introducci√≥n a AWS Academy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/ejercicio-final-ebs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    üß™ Ejercicio final: modifica, prueba en local y despliega en Elastic Beanstalk
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pr√°cticas
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Pr√°cticas
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.1. Linux Server en AWSAcademy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.2 Windows Server en AWSAcademy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.3. Conceder acceso a un segundo administrador
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.4. Comandos b√°sicos Linux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.5: Despliegue Java en AWS Elastic Beanstalk
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="practica-voluntaria-33-proxy-inverso-y-balanceo-de-carga-con-ssl-en-nginx">Practica Voluntaria 3.3 - Proxy inverso y balanceo de carga con SSL en NGINX</h1>
<h2 id="requisitos-antes-de-comenzar-la-practica">Requisitos antes de comenzar la pr√°ctica</h2>
<div class="admonition danger">
<p class="admonition-title">Atenci√≥n, muy importante antes de comenzar</p>
<ul>
<li>La pr√°ctica 4.4 ha d'estar funcionant correctament</li>
<li>No comenzar la pr√°ctica antes de tener la 1.3 <strong><em>funcionant i comprovada</em></strong></li>
</ul>
</div>
<h2 id="introduccion">Introducci√≥n</h2>
<p>A partir de las pr√°cticas anteriores hemos llegado a un escenario donde un proxy inverso act√∫a de intermediario entre dos servidores web Nginx, balanceando la carga entre ellos. </p>
<p>Ya dijimos que una importante funci√≥n que pod√≠a tener un proxy inverso era realizar el cifrado y descifrado de SSL para utilizar HTTPS en los servidores web. De esta forma se aliviaba la carga de trabajo de los servidores web, ya que es una tarea que consume recursos. </p>
<p>En definitiva, tendr√≠amos un esquema como este: </p>
<p><img alt="" src="../../img/4.1-16.png" /></p>
<p>Podr√≠a llegarse a pensar que en t√©rminos de seguridad no es adecuado que el tr√°fico de red entre el balanceador de carga y los servidores web vaya sin cifrar (HTTP). Sin embargo, pensando en un caso real, la red privada y el proxy inverso/balanceador de carga, adem√°s de estar en la misma red privada, suelen estar administrados por las mismas personas de la misma empresa, por lo que no supone un peligro real que ese tr√°fico vaya sin cifrar. </p>
<p>Podr√≠a cifrarse si fuera necesario, pero entonces pierde sentido que el proxy inverso se encargue del cifrado SSL para HTTPS, ya que har√≠amos el mismo trabajo dos veces. </p>
<p>As√≠ las cosas, nos quedaremos con el esquema de la imagen de m√°s arriba para la pr√°ctica. </p>
<h3 id="certificados">Certificados</h3>
<p>HTTPS se basa en el uso de certificados digitales. </p>
<p>Grosso modo, cuando entramos en una web v√≠a HTTPS, √©sta nos presenta un certificado digital para asegurar que es qui√©n dice ser. ¬øC√≥mo sabemos que ese certificado es v√°lido? Debemos consultar a la Autoridad de Certificaci√≥n (CA) que emiti√≥ ese certificado si es v√°lido. </p>
<p>Las CA son entidades que emiten certificados y su funcionamiento se basa en la confianza. Confiamos en que los certificados emitidos y firmados por esas entidades son reales y funcionales.  </p>
<p><img alt="" src="../../img/4.1-17.png" /></p>
<p>Los navegadores web tienen precargadas las Autoridades de Certificaci√≥n en las que conf√≠an por defecto a la hora de navegar por webs HTTPS: </p>
<p><img alt="" src="../../img/4.1-18.png" /></p>
<p>Si accedemos a una web cuyo certificado no haya sido emitido y firmado por una de estas entidades, nos saltar√° el famoso aviso: </p>
<p><img alt="" src="../../img/4.1-19.png" /></p>
<p>Ya que si el certificado no ha sido emitido y firmado por una CA de confianza, puede que se trate de una web maliciosa que nos suponga un riesgo de seguridad, como bien dice el aviso. </p>
<h2 id="tarea">Tarea</h2>
<p>Partimos de la configuraci√≥n exacta de la pr√°ctica anterior, que recordemos era esta: </p>
<p><img alt="" src="../../img/4.1-14.png" /></p>
<p>Por lo que en esta pr√°ctica simplemente debemos a√±adir la configuraci√≥n SSL para el cifrado en el Proxy Inverso: </p>
<p><img alt="" src="../../img/4.1-21.png" /></p>
<p>Tal y como quedar√° la configuraci√≥n, desde el cliente a√∫n podr√≠amos acceder a los dos servidores web con HTTP (pod√©is probarlo) pero es algo que solucionaremos en siguientes temas, configurando un firewall para que s√≥lo la IP del proxy inverso pueda acceder por HTTP a los servidores web y nadie m√°s. </p>
<h3 id="creacion-de-certificado-autofirmado">Creaci√≥n de certificado autofirmado</h3>
<p>Nosotros no utilizaremos certificados de ninguna CA de confianza, b√°sicamente porque: </p>
<ul>
<li>
<p>Nuestros servicios no est√°n publicados en Internet </p>
</li>
<li>
<p>Estos certificados son de pago </p>
</li>
</ul>
<p>As√≠ pues, nosotros crearemos nuestros propios certificados y los firmaremos nosotros mismos como si fu√©ramos una CA aut√©ntica para poder simular este escenario.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Esto provocar√° que cuando accedamos por HTTPS a nuestro sitio web por primera vez, nos salt√© el aviso de seguridad que se comentaba en la introducci√≥n. </p>
</div>
<p>En este caso no habr√° peligro puesto que estamos 100% seguros que ese certificado lo hemos emitido nosotros para esta pr√°ctica, no hay dudas. </p>
<p>Veamos pues el proceso para generar los certificados y las claves asociadas a ellos (privada/p√∫blica). En primer lugar debemos crear el siguiente directorio: </p>
<p><code>/etc/nginx/ssl</code></p>
<p>Podemos crear el certificado y las claves de forma simult√°nea con un √∫nico comando, donde: </p>
<ul>
<li>
<p><strong><code>openssl</code></strong>: esta es la herramienta por l√≠nea de comandos b√°sica para crear y administrar certificados, claves y otros archivos OpenSSL. </p>
</li>
<li>
<p><strong><code>req</code></strong>: este subcomando se utiliza para generar una solicitud de certificados y tambi√©n solicitudes de firma de certificados (CSR). </p>
</li>
<li>
<p><strong><code>-x509</code></strong>: Esto modifica a√∫n m√°s el subcomando anterior al decirle a la herramienta que queremos crear un certificado autofirmado en lugar de generar una solicitud de firma de certificado, como suceder√≠a normalmente. </p>
</li>
<li>
<p><strong><code>-nodes</code></strong>: Esto le dice a OpenSSL que omita la opci√≥n de asegurar nuestro certificado con contrase√±a. Necesitamos que Nginx pueda leer el archivo sin la intervenci√≥n del usuario cuando se inicia el servidor. Una contrase√±a evitar√≠a que esto sucediera ya que tendr√≠amos que introducirla a mano despu√©s de cada reinicio. </p>
</li>
<li>
<p><strong><code>-days 365</code></strong>: esta opci√≥n establece el tiempo durante el cual el certificado se considerar√° v√°lido. Lo configuramos para un a√±o. </p>
</li>
<li>
<p><strong><code>-newkey rsa: 2048</code></strong> : Esto especifica que queremos generar un nuevo certificado y una nueva clave al mismo tiempo. No creamos la clave necesaria para firmar el certificado en un paso anterior, por lo que debemos crearla junto con el certificado. La rsa:2048parte le dice que cree una clave RSA de 2048 bits de longitud. </p>
</li>
<li>
<p><strong><code>-keyout</code></strong>: este par√°metro le dice a OpenSSL d√≥nde colocar el archivo de clave privada generado que estamos creando. </p>
</li>
<li>
<p><strong><code>-out</code></strong>: Esto le dice a OpenSSL d√≥nde colocar el certificado que estamos creando. </p>
</li>
</ul>
<p>El comando completo ser√≠a as√≠: </p>
<p><img alt="" src="../../img/4.1-22.png" /></p>
<p>Os solicitar√° que introduzc√°is una serie de par√°metros, como v√©is en el recuadro rojo de abajo de la imagen. Deb√©is introducir los mismos par√°metros que en la imagen excepto en el ‚ÄúOrganizational Unit Name‚Äù que v√©is recuadrado en amarillo. Ah√≠ deber√©is poner <code>2DAW ‚Äì DEAW - Vuestronombre</code> </p>
<h3 id="configuracion-ssl-en-el-proxy-inverso">Configuraci√≥n SSL en el proxy inverso</h3>
<p>De la pr√°ctica anterior, dentro del directorio <code>/etc/nginx/sites-available</code> ya deb√©is tener el archivo de configuraci√≥n llamado ‚Äúbalanceo‚Äù. Es precisamente aqu√≠ donde realizaremos la configuraci√≥n para que el acceso  al sitio web se realice mediante SSL (HTTPS). </p>
<p>Dentro del bloque <code>server {‚Ä¶}</code> deb√©is cambiar el puerto de escucha (<code>listen 80</code>) por lo que v√©is en la imagen de abajo, a√±adiendo las siguientes l√≠neas de configuraci√≥n tambi√©n, de tal forma que quede: </p>
<p><img alt="" src="../../img/4.1-23.png" /></p>
<p>Donde le est√°is diciendo que: </p>
<ul>
<li>
<p>Escuche en el puerto 443 ‚Üí Puerto por defecto de HTTPS </p>
</li>
<li>
<p>El directorio donde est√° el certificado que hab√©is generado anteriormente </p>
</li>
<li>
<p>El directorio donde est√° la clave que hab√©is generado anteriormente </p>
</li>
<li>
<p>Los protocolos y tipos de cifrados que se pueden utilizar ‚Üí Estas son las versiones de protocolos y los tipos de cifrados considerados seguros a d√≠a de hoy (hay muchos m√°s pero no se consideran seguros actualmente) </p>
</li>
<li>
<p><code>server_name</code> ya lo ten√≠ais de la pr√°ctica anterior, no hace falta tocarlo </p>
</li>
<li>
<p>El archivo donde se guardan los logs cambia de nombre, ahora ser√° https_access.log </p>
</li>
</ul>
<p>Recordad que tras modificar cualquier configuraci√≥n de un servicio, hay que reiniciar el servicio, en este caso Nginx. </p>
<h3 id="comprobaciones">Comprobaciones</h3>
<ul>
<li>
<p>Si acced√©is ahora a https://balanceo os deber√≠a saltar un aviso de seguridad debido a que nuestro certificado es autofirmado, como coment√°bamos anteriormente. </p>
</li>
<li>
<p>Si a√±ad√≠s una una excepci√≥n podr√©is acceder al sitio web y recargando repetidamente la p√°gina con F5, ver√©is que el balanceo de carga se hace correctamente accediendo mediante HTTPS. </p>
</li>
<li>
<p>Para comprobar que los datos del certificado son, efectivamente, los vuestros pod√©is comprobarlo as√≠. Pulsando en el candado de la barra de b√∫squeda: </p>
</li>
</ul>
<p><img alt="" src="../../img/4.1-24.png" /></p>
<p>Con m√°s informaci√≥n:</p>
<p><img alt="" src="../../img/4.1-25.png" /></p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Aqu√≠ tambi√©n podr√©is eliminar la excepci√≥n que hab√©is a√±adido en la p√°gina de la advertencia de seguridad, por si necesit√°is reiniciar las pruebas. </p>
</div>
<p>Y por √∫ltimo, ver certificado: </p>
<p><img alt="" src="../../img/4.1-26.png" /></p>
<p>Y podremos ver los detalles: </p>
<p><img alt="" src="../../img/4.1-27.png" /></p>
<p>Si ahora intent√°is acceder a <strong><code>http://balanceo</code></strong>, ¬ødeber√≠ais poder acceder? Comprobadlo y describid qu√© pasa y por qu√©. </p>
<h3 id="redireccion-forzosa-a-https">Redirecci√≥n forzosa a HTTPS</h3>
<p>Para que, indistintamente de la forma por la que accedamos al sitio web balanceo, siempre se fuerce a utilizar HTTPS, necesitaremos una configuraci√≥n adicional. </p>
<p>Necesitamos a√±adir un bloque ‚Äúserver‚Äù adicional y separado del otro, al archivo de configuraci√≥n de ‚Äúbalanceo‚Äù. Algo as√≠: </p>
<p><img alt="" src="../../img/4.1-28.png" /></p>
<p>Con esta configuraci√≥n le estamos diciendo que: </p>
<ul>
<li>
<p>Escuche en el puerto 80 (HTTP) </p>
</li>
<li>
<p>Que el nombre al que responder√° el servidor/sitio web es balanceo </p>
</li>
<li>
<p>Que guarde los logs de este bloque en ese directorio y con ese nombre </p>
</li>
<li>
<p>Cuando se recibe una petici√≥n con las dos condiciones anteriores, se devuelve un c√≥digo HTTP 301: </p>
<ul>
<li>
<p><strong>HTTP 301 Moved Permanently</strong> (Movido permanentemente en espa√±ol) es un c√≥digo de estado de HTTP que indica que el host ha sido capaz de comunicarse con el servidor pero que el recurso solicitado ha sido movido a otra direcci√≥n permanentementeEs muy importante configurar las redirecciones 301 en los sitios web y para ello hay diferentes m√©todos y sintaxis para realizar la redirecci√≥n 301. </p>
</li>
<li>
<p>La <strong>redirecci√≥n 301</strong> es un c√≥digo o comando insertado por un Webmaster que permite redirigir a los usuarios y buscadores de un sitio web de un sitio a otro. </p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Aclaraci√≥n</p>
<p>Es decir, lo que estamos haciendo es que cuando se reciba una petici√≥n HTTP (puerto 80) en <code>http://balanceo</code>, se redirija a <code>https://balanceo</code> (HTTPS) </p>
</div>
</li>
</ul>
<div class="admonition task">
<p class="admonition-title">Tarea</p>
<ul>
<li>
<p>Eliminad del otro bloque <code>server{‚Ä¶}</code> la l√≠neas que hagan referencia a escuchar en el puerto 80 (listen 80‚Ä¶). </p>
</li>
<li>
<p>Reiniciad el servicio </p>
</li>
<li>
<p>Comprobad ahora que cuando entr√°is en <code>http://balanceo</code>, autom√°ticamente os redirige a la versi√≥n segura de la web. </p>
</li>
<li>
<p>Comprobad que cuando realiz√°is una petici√≥n en el archivo de log <code>http_access.log</code> aparece la redirecci√≥n 301 y que, de la misma manera, aparece una petici√≥n GET en <code>https_access.log</code>. </p>
</li>
</ul>
</div>
<h2 id="cuestiones-finals">Cuestiones finals</h2>
<div class="admonition task">
<p class="admonition-title">Cuesti√≥n 1</p>
<p>Hemos configurado nuestro proxy inverso con todo lo que nos hace falta pero no nos funciona y da un error del tipo <code>This site can't provide a secure connection, ERR_SSL_PROTOCOL_ERROR.</code></p>
<p>Dentro de nuestro server block tenemos esto:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nb">server</span><span class="w"> </span>{
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="nb">listen</span><span class="w"> </span><span class="m">443</span>;
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="nb">ssl_certificate</span><span class="w"> </span><span class="sx">/etc/nginx/ssl/enrico-berlinguer/server.crt</span>;
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="nb">ssl_certificate_key</span><span class="w"> </span><span class="sx">/etc/nginx/ssl/enrico-berlinguer/server.key</span>;
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="nb">ssl_protocols</span><span class="w"> </span>TLSv1.3;
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="nb">ssl_ciphers</span><span class="w"> </span>ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:ECDH+3DES:DH+3DES:RSA+AESGCM:RSA+AES:RSA+3DES:!aNULL:!MD5:!DSS;
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="nb">server_name</span><span class="w"> </span>enrico-berlinguer;
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span><span class="nb">access_log</span><span class="w"> </span><span class="sx">/var/log/nginx/https_access.log</span>;
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">    </span><span class="nb">location</span><span class="w"> </span>/<span class="w"> </span>{
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">        </span><span class="nb">proxy_pass</span><span class="w"> </span>http://red-party;
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">        </span><span class="err">}</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">    </span><span class="err">}</span>
</code></pre></div>
</div>
<div class="admonition task">
<p class="admonition-title">Cuesti√≥n 2</p>
<p>Imaginad que intentamos acceder a nuestro sitio web HTTPS y nos encontramos con el siguiente error:</p>
<p><img alt="" src="../../img/Your-connection-isnt-private-NET-ERR_CERT_REVOKED.png" /></p>
<p>Investigad qu√© est√° pasando y como se ha de solucionar.</p>
</div>
<h2 id="evaluacion">Evaluaci√≥n</h2>
<table>
<thead>
<tr>
<th style="text-align: left;">Criterio</th>
<th style="text-align: center;">Puntuaci√≥n</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Creaci√≥n correcta del certificado</td>
<td style="text-align: center;"><strong>1 puntos</strong></td>
</tr>
<tr>
<td style="text-align: left;">Configuraci√≥n SSL correcta del proxy</td>
<td style="text-align: center;"><strong>3 puntos</strong></td>
</tr>
<tr>
<td style="text-align: left;">Comprobaciones</td>
<td style="text-align: center;"><strong>2 puntos</strong></td>
</tr>
<tr>
<td style="text-align: left;">Configuraci√≥n correcta de la redirecci√≥n forzosa a HTTPS y comprobaciones</td>
<td style="text-align: center;"><strong>1 puntos</strong></td>
</tr>
<tr>
<td style="text-align: left;">Cuestiones finales</td>
<td style="text-align: center;"><strong>2 puntos</strong></td>
</tr>
<tr>
<td style="text-align: left;">SSe ha prestado especial atenci√≥n al formato del documento, utilizando la plantilla actualizada y haciendo un correcto uso del lenguaje t√©cnico</td>
<td style="text-align: center;"><strong>1 punto</strong></td>
</tr>
</tbody>
</table>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.top", "toc.integrate", "search.highlight", "content.code.annotate", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>