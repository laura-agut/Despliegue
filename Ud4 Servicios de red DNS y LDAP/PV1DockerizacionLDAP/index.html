
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://laura-agut.github.io/Despliegue/Ud4%20Servicios%20de%20red%20DNS%20y%20LDAP/PV1DockerizacionLDAP/">
      
      
        <link rel="prev" href="../P8AutenticandoNginxLDAP/">
      
      
        <link rel="next" href="../T01/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>PV1 - Dockerizaci칩n de servidor web con usuarios autenticados mediante servicio de directorio (LDAP) - Despliegue de aplicaciones web</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#practica-voluntaria-1-despliegue-de-servidores-web-con-usuarios-autenticados-mediante-ldap-usando-docker-y-docker-compose" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="Despliegue de aplicaciones web" class="md-header__button md-logo" aria-label="Despliegue de aplicaciones web" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Despliegue de aplicaciones web
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              PV1 - Dockerizaci칩n de servidor web con usuarios autenticados mediante servicio de directorio (LDAP)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="Cambiar a modo oscuro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo oscuro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Cambiar a modo claro"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo claro" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="B칰squeda" placeholder="B칰squeda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando b칰squeda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegaci칩n" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Despliegue de aplicaciones web" class="md-nav__button md-logo" aria-label="Despliegue de aplicaciones web" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Despliegue de aplicaciones web
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Despliegue de aplicaciones web
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Ud0 Introduccion
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Ud0 Introduccion
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/Ud0_1Introalmodulo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.1. Introducci칩n al m칩dulo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/Ud0_2AWS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.2. Introducci칩n a AWS Academy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/ejercicio-final-ebs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    游빍 Ejercicio final: modifica, prueba en local y despliega en Elastic Beanstalk
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pr치cticas
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Pr치cticas
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.1. Linux Server en AWSAcademy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.2 Windows Server en AWSAcademy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.3. Conceder acceso a un segundo administrador
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.4. Comandos b치sicos Linux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.5: Despliegue Java en AWS Elastic Beanstalk
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="practica-voluntaria-1-despliegue-de-servidores-web-con-usuarios-autenticados-mediante-ldap-usando-docker-y-docker-compose">Pr치ctica Voluntaria 1 - Despliegue de servidores web con usuarios autenticados mediante LDAP usando <em>Docker</em> y <em>docker-compose</em></h1>
<h2 id="introduccion">Introducci칩n</h2>
<p>Esta pr치ctica la dejamos como pr치ctica voluntaria. La principal novedad es que realiza la autenticaci칩n en NGINX de forma distinta a c칩mo la hemos hecho nosotros en la pr치ctica 8. Puede servir a quien le interese para aprender otra forma de trabajar en nginx.</p>
<h3 id="que-es-un-servicio-de-directorio-ldap">쯈u칠 es un servicio de directorio LDAP?</h3>
<p>LDAP (Lightweight Directory Access Protocol) o tambi칠n conocido como 춺Protocolo Ligero de Acceso a Directorios췉 es un protocolo de la capa de aplicaci칩n TCP/IP que permite el acceso a un servicio de directorio ordenado y distribuido, para buscar cualquier informaci칩n en un entorno de red.</p>
<div class="admonition note">
<p class="admonition-title">Aclaraci칩n</p>
<p>Un directorio es un conjunto de objetos con atributos que est치n organizados de manera l칩gica y jer치rquica, es decir, est치 en forma de 치rbol y perfectamente ordenado en funci칩n de lo que nosotros queramos, ya sea alfab칠ticamente, por usuarios, direcciones etc.</p>
</div>
<p>Generalmente un servidor LDAP se encarga de almacenar informaci칩n de autenticaci칩n, es decir, el usuario y la contrase침a, para posteriormente dar acceso a otro protocolo o servicio del sistema. Adem치s de almacenar el nombre de usuario y la contrase침a, tambi칠n puede almacenar otra informaci칩n como datos de contacto del usuario, ubicaci칩n de los recursos de la red local, certificados digitales de los propios usuarios y mucho m치s.</p>
<p>LDAP es un protocolo que nos permite acceder a los recursos de la red local, sin necesidad de crear los diferentes usuarios en el sistema operativo, adem치s, es mucho m치s vers치til. Por ejemplo, LDAP permite realizar tareas de autenticaci칩n y autorizaci칩n a usuarios de diferentes softwares como Docker, OpenVPN, servidores de archivos como los usados por QNAP, Synology o ASUSTOR entre otros, y muchos m치s usos.</p>
<p><img alt="" src="../P5_4/ldap1.webp" /></p>
<p>LDAP puede ser utilizado tanto por un usuario al que se pide unos  credenciales de acceso, como tambi칠n por las aplicaciones para saber si tienen acceso a determinada informaci칩n del sistema o no. Generalmente un servidor LDAP se encuentra en una red privada, es decir, redes de 치rea local, para autenticar las diferentes aplicaciones y usuarios, pero tambi칠n podr칤a funcionar sobre redes p칰blicas sin ning칰n problema.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>En definitiva, LDAP nos proporciona un serivicio de autenticaci칩n y autorizaci칩n para poder acceder a distintos recursos en red, como por ejemplo, a un sitio web. Si recordamos la pr치ctica de autenticaci칩n en un servidor web, nuestro usuario se autenticaba utilizando usuarios creados en el mismo sistema operativo (Debian Linux) donde se hab칤a instalado el servidor web.</p>
<p>Tenemos, por tanto, la posibilidad de utilizar otra autenticaci칩n centralizada para el mismo cometido con LDAP.</p>
</div>
<h3 id="implementaciones-de-ldap">Implementaciones de LDAP</h3>
<p>Microsoft Active Directory utiliza internamente el protocolo LDAP para realizar todas las comunicaciones desde los clientes hasta el servidor o servidores, por lo tanto, se encarga de que los clientes puedan autenticarse y acceder a cualquier dato almacenado, adem치s, debemos tener en cuenta que este protocolo es multiplataforma, no solamente lo tenemos en sistemas operativos Windows sino que tambi칠n es compatible con Linux, Unix y macOS, todo ello a trav칠s del protocolo. Para que os hag치is una idea, los siguientes servicios de directorio usan este protocolo para su comunicaci칩n:</p>
<ul>
<li>Active Directory de Microsoft</li>
<li>Apache</li>
<li>Servicio de directorio de Red Hat</li>
<li>OpenLDAP</li>
</ul>
<p>Y muchos otros servicios tambi칠n lo usan, sobre todo el 칰ltimo, OpenLDAP, el cual es una implementaci칩n de c칩digo abierto del protocolo y que se puede instalar en cualquier sistema, ya que est치 disponible el c칩digo fuente para compilarlo. No obstante, en la mayor칤a de distribuciones de Linux lo tenemos disponible en sus repositorios.</p>
<h3 id="como-se-organiza-la-informacion-en-ldap">쮺칩mo se organiza la informaci칩n en LDAP?</h3>
<p><strong>En LDAP, las entradas est치n organizadas en una estructura jer치rquica en 치rbol</strong>. Tradicionalmente, esta estructura reflejaba los l칤mites geogr치ficos y organizacionales.</p>
<p>Las entradas que representan pa칤ses aparecen en la parte superior del 치rbol. Debajo de ellos, est치n las entradas que representan los estados y las organizaciones nacionales. Debajo de est치s, pueden estar las entradas que representan las unidades organizacionales, empleados, impresoras, documentos o todo aquello que pueda imaginarse. La siguiente figura muestra un ejemplo de un 치rbol de directorio LDAP haciendo uso del nombramiento tradicional.</p>
<p><img alt="" src="../P5_4/ldap2.png" /></p>
<p>El 치rbol tambi칠n se puede organizar bas치ndose en los nombres de dominio de Internet. Este tipo de nombramiento es muy popular, ya que permite localizar un servicio de directorio haciendo uso de los DNS. La siguiente figura muestra un ejemplo de un directorio LDAP que hace uso de los nombres basados en dominios.</p>
<p><img alt="" src="../P5_4/ldap3.png" /></p>
<h4 id="como-se-referencia-la-informacion">쮺칩mo se referencia la informaci칩n?</h4>
<p>Una entrada es referenciada por su nombre distinguido (DN), que es construido por el nombre de la propia entrada (llamado Nombre Relativo Distinguido o RDN) y la concatenaci칩n de los nombres de las entradas que le anteceden. </p>
<p>Por ejemplo, la entrada para Nuno Gon칞alves en el ejemplo del nombramiento de Internet anterior tiene el siguiente RDN: uid=nuno y su DN ser칤a: uid=nuno,ou=estig,dc=ipb,dc=pt.  </p>
<h4 id="como-se-accede-a-la-informacion">C칩mo se accede a la informaci칩n?</h4>
<p>LDAP define operaciones para interrogar y actualizar el directorio. Provee operaciones para a침adir y borrar entradas del directorio, modificar una entrada existente y cambiar el nombre de una entrada. La mayor parte del tiempo, sin embargo, LDAP se utiliza para buscar informaci칩n almacenada en el directorio. Las operaciones de b칰squeda de LDAP permiten buscar entradas que concuerdan con alg칰n criterio especificado por un filtro de b칰squeda. La informaci칩n puede ser solicitada desde cada entrada que concuerda con dicho criterio.</p>
<p>Por ejemplo, imaginemos que queremos buscar en el sub치rbol del directorio que est치 por debajo de dc=ipb,dc=pt a personas con el nombre Nuno Gon칞alves, obteniendo la direcci칩n de correo electr칩nico de cada entrada que concuerde. LDAP permite hacer esto f치cilmente. O tal vez preferimos buscar las organizaciones que posean la cadena IPB en su nombre, posean n칰mero de fax y est칠n debajo de la entrada st=Bragan칞a,c=PT. LDAP permite hacer esto tambi칠n.</p>
<p>LDAP ofrece una autenticaci칩n y autorizaci칩n optimizadas y una b칰squeda eficaz de datos de direcciones y de usuarios. Debido a sus muchas ventajas para las empresas. LDAP sirve a modo de un est치ndar de la industria y es compatible con la mayor칤a de los productos de software. Las ventajas principales son la rapidez de las consultas y conexiones, un lenguaje de consulta sencillo y un protocolo claramente estructurado</p>
<h3 id="modulos-en-apache">M칩dulos en Apache</h3>
<p>Un m칩dulo es una parte independiente de un programa. La mayor parte de la funcionalidad de Apache est치 contenida en m칩dulos que pueden incluirse o excluirse. Como decimos, existen una gran cantidad de M칩dulos para utilizarse con Apache, algunos ejemplo son: "Virtual Hosting","Mod_JK(Java)" y "Rewrite".</p>
<p>Una de las principales razones de emplear m칩dulos en Apache, es que no toda instalaci칩n requiere de las mismas funcionalidades, esto es, una instalaci칩n que utilice PHP probablemente no requiera de Tomcat (Java), o bien posiblemente no todas las instalaciones requieran de "Virtual Hosting".</p>
<p>As칤 las cosas, para no incluir todas las funcionalidades de Apache, necesarias e innecesarias para cada ocasi칩n, en un 칰nico paquete de instalaci칩n que lo har칤a demasiado grande en tama침o y pesado en recursos, se hace uso de los m칩dulos, de tal forma que s칩lo cargaremos en memoria los que nos hagan falta en cada ocasi칩n.</p>
<p>Los m칩dulos le permiten a los administradores del servidor activar y desactivar funcionalidades adicionales. Apache tiene m칩dulos de seguridad, almacenamiento en cach칠, reescritura de URL, autenticaci칩n de contrase침a y m치s.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>En Apache hay dos tipos de m칩dulos:</p>
<ul>
<li><strong>Est치ticos:</strong> Son a침adidos al compilar el servidor.</li>
<li><strong>Din치micos:</strong> Se cargan din치micamente al iniciar el servidor. </li>
</ul>
</div>
<p>Se puede habilitar cualquiera de los m칩dulos de la lista con el comando <code>a2enmod (nombre del m칩dulo)</code> (usando el <code>sudo</code> si no se es superusuario), y deshabilitar cualquiera de ellos previamente habilitado mediante el comando <code>a2dismod (nombre del m칩dulo)</code>  (usando el <code>sudo</code> si no se es superusuario).</p>
<h3 id="modulos-en-nginx">M칩dulos en Nginx</h3>
<p>Los m칩dulos <u>est치ticos</u> existen desde sus inicios en Nginx y los <u>din치micos</u> desde la versi칩n 1.9.11 (Febrero de 2016).</p>
<p>Nginx es, de hecho, una colecci칩n de m칩dulos. Incluso funciones b치sicas tales como HTTP o servir ficheros est치ticos dentro de HTTP, est치n implementadas por m칩dulos.</p>
<p>Se puede extender la funcionalidad de Nginx a침adiendo m칩dulos propios. Esta arquitectura modular permite modificar f치cilmente Nginx.</p>
<h4 id="modulo-autenticacion-ldap-en-nginx">M칩dulo autenticaci칩n LDAP en Nginx</h4>
<p>La soluci칩n aprovecha el m칩dulo ngx_http_auth_request_module de Nginx, que reenv칤a las peticiones de autenticaci칩n a un servicio externo. En la implementaci칩n de referencia, ese servicio es un demonio que llamamos ldap-auth. Est치 escrito en Python y se comunica con un servidor de autenticaci칩n del Protocolo Ligero de Acceso a Directorios (LDAP) - OpenLDAP por defecto, pero hemos probado el demonio ldap-auth tambi칠n con configuraciones por defecto de Microsoft춽 Windows춽 Server Active Directory (tanto la versi칩n 2003 como la 2012).</p>
<p>Para realizar la autenticaci칩n, el m칩dulo http_auth_request realiza una subconsulta HTTP al demonio ldap-auth, que act칰a como intermediario e interpreta la subconsulta para el servidor LDAP - utiliza HTTP para la comunicaci칩n con Nginx y la API apropiada para la comunicaci칩n con el servidor LDAP.</p>
<p><img alt="" src="../P5_4/ldap4.jpeg" /></p>
<p>A continuaci칩n se describe paso a paso el proceso de autenticaci칩n en la implementaci칩n de referencia. Los detalles se determinan por los ajustes en el archivo de configuraci칩n nginx-ldap-auth.conf; ver Configuraci칩n de la implementaci칩n de referencia m치s abajo. </p>
<p>El diagrama de flujo debajo de los pasos resume el proceso.</p>
<p><img alt="" src="../P5_4/ldap5.jpeg" /></p>
<ol>
<li>
<p>Un cliente env칤a una solicitud HTTP para un recurso protegido alojado en un servidor para el que Nginx est치 actuando como proxy inverso.</p>
</li>
<li>
<p>Nginx (concretamente, el m칩dulo <em>http_auth_request</em>) reenv칤a la solicitud al demonio <em>ldap-auth</em>, que responde con el c칩digo HTTP 401 porque no se han proporcionado credenciales.</p>
</li>
<li>
<p>Nginx reenv칤a la solicitud a <code>http://backend/login</code>, que corresponde al demonio del backend. Escribe el URI de la solicitud original en la cabecera X-Target de la solicitud reenviada.</p>
</li>
<li>
<p>El demonio del backend env칤a al cliente un formulario de inicio de sesi칩n (el formulario est치 definido en el c칩digo Python del demonio). Tal y como se configura en la directiva error_page, NGINX establece el c칩digo HTTP del formulario de inicio de sesi칩n en 200.</p>
</li>
<li>
<p>El usuario rellena los campos <em>Nombre de usuario</em> y <em>Contrase침a</em> en el formulario y hace clic en el bot칩n Login. Seg칰n el c칩digo del formulario, el cliente genera una petici칩n HTTP POST dirigida a <code>/login</code>, que Nginx reenv칤a al demonio del backend.</p>
</li>
<li>
<p>El demonio del backend construye una cadena con el formato nombre de <code>usuario:contrase침a</code>, aplica la codificaci칩n Base64, genera una cookie llamada <strong>nginxauth</strong> con su valor establecido a la cadena codificada, y env칤a la cookie al cliente. Establece el flag httponly para evitar el uso de JavaScript para leer o manipular la cookie (protegiendo contra la vulnerabilidad cross-site scripting [XSS]).</p>
</li>
<li>
<p>El cliente retransmite su solicitud original (del paso 1), esta vez incluyendo la cookie en el campo Cookie de la cabecera HTTP. Nginx reenv칤a la solicitud al demonio <code>ldap-auth</code> (como en el paso 2).</p>
</li>
<li>
<p>El demonio <code>ldap-auth</code> decodifica la cookie y env칤a el nombre de usuario y la contrase침a al servidor LDAP en una solicitud de autenticaci칩n.</p>
</li>
<li>
<p>La siguiente acci칩n depende de si el servidor LDAP autentifica con 칠xito al usuario:</p>
<ul>
<li>
<p>Si la autenticaci칩n tiene 칠xito, el demonio <code>ldap-auth</code> env칤a el c칩digo HTTP 200 a Nginx. Nginx solicita el recurso al demonio del backend y 칠ste devuelve el c칩digo del sitio web.</p>
<p>El archivo <code>nginx-ldap-auth.conf</code> incluye directivas para el almacenamiento en cach칠 de los resultados del intento de autenticaci칩n.</p>
</li>
<li>
<p>Si la autenticaci칩n falla, el demonio <code>ldap-auth</code> env칤a el c칩digo HTTP 401 a Nginx. Nginx reenv칤a la solicitud al demonio del backend de nuevo (como en el paso 3), y el proceso se repite.</p>
</li>
</ul>
</li>
</ol>
<h2 id="despliegue-con-docker-de-nginx-demonio-de-autenticacion-ldap-openldap">Despliegue con Docker de <strong>NGINX + demonio de autenticaci칩n LDAP + OpenLDAP</strong></h2>
<p>Para esta pr치ctica nos crearemos un directorio que contendr치 nuestro index.html, con un texto muy simple:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>$<span class="w"> </span>mkdir<span class="w"> </span>app
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>$<span class="w"> </span>cat<span class="w"> </span><span class="s">&lt;&lt; EOF &gt; app/index.html</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="s">&lt;html&gt;</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="s">&lt;body&gt;</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="s">&lt;h1&gt;춰Hola Mundo!&lt;/h1&gt;</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="s">&lt;/body&gt;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="s">&lt;/html&gt;</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="s">EOF</span>
</code></pre></div>
<p>As칤 como otro directorio, con el contenido de la configuraci칩n pertinente de Nginx:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>$<span class="w"> </span>mkdir<span class="w"> </span>conf
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>$<span class="w"> </span>cat<span class="w"> </span><span class="s">&lt;&lt; EOF &gt; conf/ldap_nginx.conf</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="s">    server {</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="s">      listen 8080;</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="s">      location = / {</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="s">         auth_request /auth-proxy;</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="s">      }</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="s">      location = /auth-proxy {</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="s">         internal;</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="s">         proxy_pass http://nginx-ldap:8888;</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="s">         # URL y puerto para conectarse al servidor LDAP</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="s">         proxy_set_header X-Ldap-URL &quot;ldap://openldap:1389&quot;;</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="s">         # Base DN</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="s">         proxy_set_header X-Ldap-BaseDN &quot;dc=example,dc=org&quot;;</span>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="s">         # Bind DN</span>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="s">         proxy_set_header X-Ldap-BindDN &quot;cn=admin,dc=example,dc=org&quot;;</span>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="s">         # Bind password</span>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="s">         proxy_set_header X-Ldap-BindPass &quot;adminpassword&quot;;</span>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="s">      }</span>
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="s">   }</span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="s">EOF</span>
</code></pre></div>
En esta configuraci칩n le decimos a Nginx:</p>
<ul>
<li>Que escuche en el puerto 8080 las peticiones HTTP</li>
<li>Que cuando se acceda al sitio web, se solicite autorizaci칩n en el directorio del sitio web llamado <em>/auth-proxy</em></li>
<li>Se crea un nuevo location para ese directorio <em>/auth-proxy</em> y que es donde se realizar치 la configuraci칩n de c칩mo conectarnos a nuestro openldap, de acuerdo con la <a href="https://www.nginx.com/blog/nginx-plus-authenticate-users/#ldap-auth-configure">documentaci칩n oficial de Nginx</a> a prop칩sito de su m칩dulo de autenticaci칩n:</li>
<li>Se indica la URL de nuestro openldap (es el nombre del contenedor que hemos levantado, ya que Docker tiene un DNS propio entre sus contenedores)</li>
<li>El DN (Nombre distinguido) base sobre el que se realizar치n las b칰squedas en openldap</li>
<li>El usuario y contrase침a con el que nos conectaremos al openldap para realizar las consultas</li>
</ul>
<p>Y ahora, procedemos con el siguiente <code>docker-compose.yml</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2&#39;</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">  </span><span class="nt">nginx-ldap</span><span class="p">:</span><span class="w">  </span><span class="c1"># (1)</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bitnami/nginx-ldap-auth-daemon-archived</span><span class="w"> </span><span class="c1"># (2)</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w"> </span><span class="c1"># (3)</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8888:8888</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">  </span><span class="nt">nginx</span><span class="p">:</span><span class="w"> </span><span class="c1"># (4)</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bitnami/nginx</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080:8080</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w"> </span><span class="c1"># (5)</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./app:/app</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./conf/ldap_nginx.conf:/opt/bitnami/nginx/conf/server_blocks/ldap_nginx.conf</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">  </span><span class="nt">openldap</span><span class="p">:</span><span class="w"> </span><span class="c1"># (6)</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bitnami/openldap</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;1389:1389&#39;</span><span class="w">    </span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="c1"># (7)</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LDAP_ADMIN_USERNAME=admin</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LDAP_ADMIN_PASSWORD=adminpassword</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LDAP_USERS=customuser</span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LDAP_PASSWORDS=custompassword</span>
</code></pre></div>
<ol>
<li>Nombre del contenedor</li>
<li>Imagen que descargaremos del Dockerhub y a partir de la cual crearemos nuestro contenedor</li>
<li>Puerto/s que se publicar치n para el contenedor</li>
<li>Nombre del contenedor</li>
<li>Vol칰menes o directorios compartidos entre nuestra m치quina y el contenedor</li>
<li>Nombre del contenedor</li>
<li>Variables de entorno utilizadas para la configuraci칩n de este contenedor. Incluye credenciales del administrador de openldap, as칤 como un usuario que se crear치 en dicho openldap (pod칠is cambiar usuario y contrase침a si quer칠is, pero luego deb칠is recordarlas)</li>
</ol>
<p>Tras esto s칩lo queda ejecutar compose:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>docker-compose<span class="w"> </span>up
</code></pre></div>
<div class="admonition task">
<p class="admonition-title">Tarea</p>
<p>Comprobar que puedes acceder a <code>http://IP_Maq_Virtual:8080</code> y loguearte en el servidor LDAP que acabas de desplegar.</p>
</div>
<h2 id="despliegue-con-docker-de-php-apache-con-autenticacion-ldap">Despliegue con Docker de PHP + Apache con autenticaci칩n LDAP</h2>
<ol>
<li>
<p>Creamos un directorio que se llame <code>Practica7_3</code></p>
</li>
<li>
<p>En primer lugar, como es obvio, dentro del directorio creado debemos crear el <code>index.php</code> de nuestra aplicaci칩n:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="x">  </span><span class="cp">&lt;?php</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>  <span class="k">echo</span> <span class="s1">&#39;Well, hello LDAP authenticated user!&#39;</span><span class="p">;</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>  <span class="cp">?&gt;</span>
</code></pre></div>
</li>
<li>
<p>Dentro de nuestro directorio de trabajo, creado anteriormente, crearemos otro directorio llamado <code>Docker</code> y dentro de 칠l, un Dockerfile (<code>./Docker/Dockerfile</code>)</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>En Linux, cuando queremos hacer referencia al directorio actual, lo hacemos con un punto <code>.</code> </p>
<p>Si dentro de nuestro directorio actual tenemos una carpeta llamada <code>prueba</code>, podemos hacer referencia a ella como <code>./prueba</code>, ya que el <code>.</code> hace referencia precisamente al directorio donde nos encontramos.</p>
</div>
<p>Para completar este Dockerfile con las opciones/directivas adecuadas, leed los comentarios y pod칠is apoyaros <a href="https://raul-profesor.github.io/DEAW/dockerfile/?h=dockerfile#mi-primer-dockerfile">en la teor칤a</a> o en <a href="https://devhints.io/dockerfile">este cheatsheet</a>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c"># ./Docker/Dockerfile --&gt; directorio donde se encuentra este archivo</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="c"># Imagen base sobre la que vamos a trabajar</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>____<span class="w"> </span>php:7-apache
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="c"># Activamos el m칩dulo LDAP de Apache ejecutand el siguiente comando</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>____<span class="w"> </span>a2enmod<span class="w"> </span>authnz_ldap
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="c"># A침adimos las reglas/configuraci칩n de LDAP al directorio conf-enabled de Apache</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="c"># (crearemos este archivo en el siguiente paso)</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>____<span class="w"> </span>Docker/ldap-demo.conf<span class="w"> </span>/etc/apache2/conf-enabled/
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="c"># A침adimos ayuda de depuraci칩n (debugging) en la configuraci칩n de apache</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="c"># En caso de necesitarlo, lo descomentamos para ejecutar el siguiente comando</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="c"># ____ echo &quot;LogLevel debug&quot; &gt;&gt; apache2.conf</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="c"># Establecemos el directorio de trabajo adecuado</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>____<span class="w"> </span>/var/www/html/demo
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="c"># Configuramos Apache para usar la configuraci칩n ldap definida arriba, la copiamos de nuestro ordenador al contenedor</span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>____<span class="w"> </span>Docker/.htaccess<span class="w"> </span>./.htaccess
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="c">#  Copiamos los archivos del proyecto que necesitamos, al contenedor</span>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a>____<span class="w"> </span>index.php<span class="w"> </span>./
</code></pre></div>
<div class="admonition task">
<p class="admonition-title">Tarea</p>
<p>Completa el Dockerfile.</p>
</div>
</li>
<li>
<p>Ahora crearemos el archivo <code>./Docker/ldap-demo.conf</code>, que es la configuraci칩n LDAP. Aqu칤 establecemos los criterios de conexi칩n con el contenedor de Openldap, password y URL.</p>
<p>Las directivas <code>PassEnv</code> al principio del archivo nos permiten omitir nuestras credenciales y pasarlas luego como variables de entorno al correr la imagen del contenedor:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># ./Docker/ldap-demo.conf</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>PassEnv<span class="w"> </span>LDAP_BIND_ON
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>PassEnv<span class="w"> </span>LDAP_PASSWORD
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>PassEnv<span class="w"> </span>LDAP_URL
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>&lt;AuthnProviderAlias<span class="w"> </span>ldap<span class="w"> </span>demo&gt;
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">    </span>AuthLDAPBindDN<span class="w"> </span><span class="si">${</span><span class="nv">LDAP_BIND_ON</span><span class="si">}</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">    </span>AuthLDAPBindPassword<span class="w"> </span><span class="si">${</span><span class="nv">LDAP_PASSWORD</span><span class="si">}</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">    </span>AuthLDAPURL<span class="w"> </span><span class="si">${</span><span class="nv">LDAP_URL</span><span class="si">}</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>&lt;/AuthnProviderAlias&gt;<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Creamos el archivo .htaccess:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c"># ./Docker/.htaccess</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="nb">AuthBasicProvider</span><span class="w"> </span>demo
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="nb">AuthType</span><span class="w"> </span>Basic
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="nb">AuthName</span><span class="w"> </span><span class="s2">&quot;Protected Area&quot;</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="nb">Require</span><span class="w"> </span>valid-user
</code></pre></div>
</li>
<li>
<p>Dentro de nuestro directorio de trabajo, construimos la imagen con el siguiente comando:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>docker<span class="w"> </span>build<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">    </span>-t<span class="w"> </span>docker-ldap<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">    </span>-f<span class="w"> </span>./Docker/Dockerfile<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">    </span>.
</code></pre></div>
</li>
<li>
<p>Corremos el contenedor indicando las credenciales de nuestra cuenta LDAP mediante variables de entorno con la flag <code>-e</code>. Para este caso, vamos a probar un servidor LDAP externo, csimulando que tuvi칠ramos que integrar nuestro despliegue con un servidor ya existente en la empresa. Utilizaremos un servidor p칰blico en Internet dedicado a pruebas: <a href="https://www.forumsys.com/2022/05/10/online-ldap-test-server/">https://www.forumsys.com/2022/05/10/online-ldap-test-server/</a></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>docker<span class="w"> </span>run<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span>-p<span class="w"> </span><span class="m">8080</span>:80<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span>--name<span class="w"> </span>ldap_demo<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">    </span>-e<span class="w"> </span><span class="nv">LDAP_BIND_ON</span><span class="o">=</span><span class="s1">&#39;cn=read-only-admin,dc=example,dc=com&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">    </span>-e<span class="w"> </span><span class="nv">LDAP_PASSWORD</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">    </span>-e<span class="w"> </span><span class="nv">LDAP_URL</span><span class="o">=</span><span class="s1">&#39;LDAP://ldap.forumsys.com/dc=example,dc=com&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">    </span>docker-ldap
</code></pre></div>
</li>
<li>
<p>No nos queda m치s que visitar <code>http://IP-M치q-Debian:8080/demo</code>. Si todo ha ido bien, nos solicitar치 nuestras credenciales para loguearnos contra el servidor openldap. Puedes acceder a <a href="https://www.forumsys.com/2022/05/10/online-ldap-test-server/">https://www.forumsys.com/2022/05/10/online-ldap-test-server/</a> para obtener usuarios y sus passwords.</p>
</li>
</ol>
<h2 id="referencias">Referencias</h2>
<p><a href="https://www.redeszone.net/tutoriales/servidores/que-es-ldap-funcionamiento/">Para qu칠 sirve el protocolo LDAP y c칩mo funciona</a></p>
<p><a href="https://www.sergio-gonzalez.com/doc/10-ldap-samba-cups-pykota/html/openldap-que-es.html">OpenLDAP conceptos te칩ricos</a></p>
<p><a href="https://www.nginx.com/blog/nginx-plus-authenticate-users/">Using Nginx and NGINX to Authenticate Application Users with LDAP</a></p>
<p><a href="https://medium.com/ihme-tech/simple-docker-apache-php-authentication-with-ldap-3ac16b17bf31">Simple Docker/Apache/PHP Authentication with LDAP</a></p>
<p><a href="https://hub.docker.com/r/bitnami/nginx-ldap-auth-daemon-archived">bitnami/nginx-ldap-auth-daemon-archived</a></p>
<p><a href="https://github.com/nginxinc/nginx-ldap-auth/">nginxinc/nginx-ldap-auth</a></p>
<p><a href="https://devhints.io/dockerfile">Dockerfile cheatsheet</a></p>
<p><a href="https://stackoverflow.com/questions/37461868/difference-between-run-and-cmd-in-a-dockerfile">Difference between RUN and CMD in a Dockerfile</a></p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.top", "toc.integrate", "search.highlight", "content.code.annotate", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>