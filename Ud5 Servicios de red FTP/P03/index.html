
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://laura-agut.github.io/Despliegue/Ud5%20Servicios%20de%20red%20FTP/P03/">
      
      
        <link rel="prev" href="../P02/">
      
      
        <link rel="next" href="../P04/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>Pr치ctica 3. Configuraci칩n de servidor FTP con Cifrado - Despliegue de aplicaciones web</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#practica-3-configuracion-de-servidor-ftp-con-cifrado" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="Despliegue de aplicaciones web" class="md-header__button md-logo" aria-label="Despliegue de aplicaciones web" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Despliegue de aplicaciones web
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Pr치ctica 3. Configuraci칩n de servidor FTP con Cifrado
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="Cambiar a modo oscuro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo oscuro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Cambiar a modo claro"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo claro" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="B칰squeda" placeholder="B칰squeda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando b칰squeda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegaci칩n" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Despliegue de aplicaciones web" class="md-nav__button md-logo" aria-label="Despliegue de aplicaciones web" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Despliegue de aplicaciones web
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Despliegue de aplicaciones web
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Ud0 Introduccion
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Ud0 Introduccion
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/Ud0_1Introalmodulo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.1. Introducci칩n al m칩dulo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/Ud0_2AWS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.2. Introducci칩n a AWS Academy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/ejercicio-final-ebs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    游빍 Ejercicio final: modifica, prueba en local y despliega en Elastic Beanstalk
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pr치cticas
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Pr치cticas
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.1. Linux Server en AWSAcademy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.2 Windows Server en AWSAcademy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.3. Conceder acceso a un segundo administrador
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.4. Comandos b치sicos Linux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.5: Despliegue Java en AWS Elastic Beanstalk
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="practica-3-configuracion-de-servidor-ftp-con-cifrado">Pr치ctica 3. Configuraci칩n de servidor FTP con Cifrado</h1>
<p>En esta pr치ctica, aprenderemos c칩mo asegurar la conexi칩n usando el protocolo SSL/TLS, de esta forma se podr치n transferir datos encriptados a trav칠s de FTP.</p>
<p>Recuerda de la teor칤a que hay 2 modos de conexi칩n cifrada de FTP, FTPS y SFTP y que no tienen nada que ver en cuanto a configuraci칩n y funcionamiento.</p>
<ul>
<li>FTPS (File Transfer Protocol Secure) - Es a FTP lo que HTTPS a HTTP. Es el servidor FTP quien define sus claves p칰blica y privada. Comparte su clave p칰blica con el cliente que quiere conectarse a 칠l para establecer el canal privado. Por tanto requiere de la generaci칩n de dichas claves en el servidor y la configuraci칩n en vsftpd.conf. Adem치s tiene 2 formas de conexi칩n<ul>
<li>FTPS Expl칤cito (FTPES): En este modo, la seguridad SSL/TLS se inicia despu칠s de que el cliente se conecta al servidor y emite un comando espec칤fico (por ejemplo, AUTH TLS o AUTH SSL) para solicitar una conexi칩n segura. Por tanto la primera conexi칩n del cliente al servidor es por el puerto habitual de comandos de FTP, el 21.</li>
<li>FTPS Impl칤cito (FTPIS): En este modo, la seguridad SSL/TLS se establece autom치ticamente cuando el cliente se conecta al servidor en un puerto espec칤fico (generalmente el puerto 990 para FTPS impl칤cito).</li>
</ul>
</li>
<li>SFTP (SSH File Transfer Protocol) - Aqu칤 primero se establece un canal SSH entre cliente y servidor SSH (no vsftpd) a trav칠s del puerto habitula ssh, el 22.. Una vez establecido el canal el cliente ftp y vsftpd intercambian mensajes cifrados dentro de ese canal. Por tanto, vsftpd no necesita ninguna configuraci칩n especial</li>
</ul>
<p>En esta pr치ctica veremos las 2 formas de funcionamiento y conexi칩n.</p>
<h2 id="instancia-en-aws">Instancia en AWS</h2>
<p>Primero abriremos la instancia AWS P4-vsftpd creada en la pr치ctica anterior, donde ya ten칤amos instalado el servidor vsftpd y usuarios con permisos a FTP.</p>
<h2 id="servidor-vsftpd">Servidor vsftpd</h2>
<p>Comprobamos el estado del servicio y en caso de que no est칠 habilita el servicio al inicio.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>vsftpd
</code></pre></div>
<p>En caso de que no est칠 iniciado el servicio, realizar estos pasos;</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>vsftpd
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>vsftpd.service
</code></pre></div>
<h2 id="ftps-file-transfer-protocol-secure">FTPS (File Transfer Protocol Secure)</h2>
<p>Veamos primero la configuraci칩n y conexi칩n a trav칠s de FTPS.</p>
<h3 id="generar-un-certificado-autofirmado-con-openssl">Generar un certificado autofirmado con OpenSSL</h3>
<p>Ya hemos visto que el servidor vsftpd admite FTPS (FTP sobre SSL/TLS), es decir que cifra las comunicaciones entre el cliente y el servidor. As칤 que para poder transferir datos encriptados a trav칠s de FTP, necesitaremos crear un certificado SSL y habilitar la conexi칩n SSL/TLS. Por ello vamos a utilizar OpenSSL con el siguiente comando;</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>sudo<span class="w"> </span>openssl<span class="w"> </span>req<span class="w"> </span>-x509<span class="w"> </span>-nodes<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span><span class="w"> </span>-newkey<span class="w"> </span>rsa:2048<span class="w"> </span>-keyout<span class="w"> </span>/etc/ssl/private/vsftpd.pem<span class="w"> </span>-out<span class="w"> </span>/etc/ssl/private/vsftpd.pem
</code></pre></div>
Tenemos que tener en cuenta que nos pedir치 que ingresemos cierta informaci칩n, como el pa칤s, el estado/provincia y el nombre com칰n. Puede ingresar los valores que desee o dejarlos en blanco.</p>
<p>Este comando genera un certificado SSL autofirmado v치lido por 365 d칤as y guarda la clave privada y el certificado en <code>/etc/ssl/private/vsftpd-cert.pem</code></p>
<p>Podemos comprobarlo con el comando 
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>sudo<span class="w"> </span>ls<span class="w"> </span>-l<span class="w"> </span>/etc/ssl/private
</code></pre></div></p>
<h3 id="configurar-el-servidor-vsftpd">Configurar el servidor vsftpd</h3>
<p><strong>1. Habilitar el cifrado SSL</strong></p>
<p>Una vez que tengamos el certificado SSL y la clave privada, tendremos que modificar el archivo /etc/vsftpd.conf. Para ello buscamos el archivo de configuraci칩n y guardamos una copia de 칠l por si acaso: </p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>sudo<span class="w"> </span>cp<span class="w"> </span>/etc/vsftpd.conf<span class="w"> </span>/etc/vsftpd.conf.backup2
</code></pre></div>
Pasamos a modificar el archivo de configuraci칩n utilizando un editor.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>sudo<span class="w"> </span>nano<span class="w"> </span>/etc/vsftpd.conf
</code></pre></div>
En primer lugar, buscaremos las siguientes l칤neas del archivo y las <strong>eliminaremos o comentaremos con #</strong>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>rsa_cert_file<span class="s">=/etc/ssl/certs/ssl-cert-snakeoil.pem</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>rsa_private_key_file<span class="s">=/etc/ssl/private/ssl-cert-snakeoil.key</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>ssl_enable<span class="s">=NO</span>
</code></pre></div>
Tras ello, <strong>a침adiremos</strong> estas l칤neas en su lugar;</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>rsa_cert_file<span class="s">=/etc/ssl/private/vsftpd.pem</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>rsa_private_key_file<span class="s">=/etc/ssl/private/vsftpd.pem</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>ssl_enable<span class="s">=YES</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>allow_anon_ssl<span class="s">=NO</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>force_local_data_ssl<span class="s">=YES</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>force_local_logins_ssl<span class="s">=YES</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>ssl_tlsv1<span class="s">=YES</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>ssl_sslv2<span class="s">=NO</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>ssl_sslv3<span class="s">=NO</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>require_ssl_reuse<span class="s">=NO</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>ssl_ciphers<span class="s">=HIGH</span>
</code></pre></div>
<p>Al conectarnos utilizando FTPS el servidor forzar치 al cliente a realizar una conexi칩n pasiva por segurida, como vimos en la teor칤a. Si no hacemos nada m치s, tras el primer intercambio de 칩rdenes a trav칠s del puerto 21, la conexi칩n no podr치 establecerse por el puerto de datos y obtendremos un mensaje similar a este "El servidor envi칩 una respuesta pasiva con una direcci칩n no enrutable. Usando en su lugar la direcci칩n del servidor."</p>
<p><strong>2. Habilitar el modo pasivo</strong></p>
<p>Para evitar que esto ocurra, definiremos los puertos que puede abrir el servidor para el canal de datos en la conexi칩n pasiva en el fichero /etc/vsftpd.conf con las siguientes 칩rdenes:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>pasv_enable<span class="s">=YES</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>pasv_min_port<span class="s">=1027  # Puerto m칤nimo de conexi칩n pasiva (reemplaza XXXX con un n칰mero)</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>pasv_max_port<span class="s">=1030  # Puerto m치ximo de conexi칩n pasiva (reemplaza XXXX con un n칰mero)</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>pasv_address<span class="s">=X.X.X.X  # Direcci칩n IP p칰blica o accesible desde el cliente (reemplaza X.X.X.X con la direcci칩n IP)</span>
</code></pre></div>
En este caso hemos elegido los puertos 1027 a 1030, pero puedes elegir otros que est칠n libres. Ten en cuenta que deber치s abrir esos puertos en el firewall de AWS para permitir conexiones a esos puertos.</p>
<p>La 칰ltima l칤nea pasv_address=X.X.X.X es opcional y si la pones debes poner la IP p칰blica de tu servidor. Si no la pones, cuando te conectes con el cliente recibir치s un mensaje similar a "<em>El servidor envi칩 una respuesta pasiva con una direcci칩n no enrutable. Usando en su lugar la direcci칩n del servidor.</em>", pero funcionar치 igual. Si la pones ten en cuenta que cada vez que cambie la IP p칰blica de tu servidor deber치s cambiar esta l칤nea en la configuraci칩n.</p>
<h3 id="reinicia-el-servicio">Reinicia el servicio</h3>
<p>Finalmente reiniciamos el servicio vsftpd para que coja la nueva configuraci칩n realizada en todos estos pasos.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>--now<span class="w"> </span>vsftpd
</code></pre></div>
<h3 id="comprobar-la-conexion-ftp-al-servidor-vsftpd">Comprobar la Conexi칩n FTP al servidor vsftpd</h3>
<h4 id="acceso-con-cliente-ftp-de-consola">Acceso con Cliente FTP de consola</h4>
<ol>
<li>Abre una terminal en tu sistema. </li>
<li>Desde Linux/Mac, abre el terminal del sistema</li>
<li>
<p>Desde Windows, abre el "S칤mbolo del sistema" o "PowerShell". Puedes hacerlo buscando "cmd" o "PowerShell" en el men칰 de inicio o escribiendo "cmd" en la barra de b칰squeda.</p>
</li>
<li>
<p>En la terminal, escribe el siguiente comando para iniciar una sesi칩n FTP. Debes reemplazar <em>nombre_de_host_ftp</em> con la direcci칩n IP P칔BLICA o el nombre de dominio del servidor FTP al que deseas conectarte:</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>ftp nombre_de_host_ftp
</code></pre></div>
<ol>
<li>Una vez que ingreses el comando, el cliente FTP intentar치 establecer una conexi칩n con el servidor. Si la conexi칩n es exitosa, ver치s un mensaje similar a este:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>Connected to nombre_de_host_ftp.
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>220 (nombre_del_servidor_ftp) FTP server ready
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>Name (nombre_de_host_ftp:tu_nombre_de_usuario_ftp):
</code></pre></div>
<ol>
<li>A continuaci칩n, el cliente FTP te pedir치 que ingreses un usuario (en nuestro caso recuerda que era <strong>userftp</strong>)  y presiona "Enter". Luego, se te pedir치 que ingreses la contrase침a (recuerda que era <strong>ieselcaminas</strong>). Si las credenciales son correctas, deber칤as obtener acceso al servidor FTP. Verifica que el prompt a cambiado a ftp&gt; (quiere decir que has conectado correctamente). Es posible que si el cliente ftp no conoce el certificado del servidor no te permita la conexi칩n. Si esto ocurre no te preocupes e intenta la conexi칩n con el cliente gr치fico, que suele solucionar ese inconveniente.</li>
</ol>
<h4 id="acceso-con-cliente-ftp-grafico">Acceso con Cliente FTP gr치fico</h4>
<p>Vamos a utilizar como <strong>cliente FTP</strong> con entorno gr치fico a <a href="https://filezilla-project.org/">Filezilla</a>, que dispone de versiones para GNU/Linux, Mac OS X y Windows. Tras descargar <U><strong>el cliente FTP</strong></u> en nuestro ordenador vamos a crear una conexi칩n para usarla m치s adelante. Lo haremos siguiendo los pasos de la pr치ctica 4.1 Acceso a un servidor FTP p칰blico con los siguientes datos:</p>
<p><img alt="" src="../P4_2/P4_2_7.png" /></p>
<p>F칤jate que usamos FTP y no SFTP, que usamos FTPS Expl칤cito y que el puerto est치 vac칤o, porque usar치 el 21, que es el puerto por defecto. Puedes ponerlo y ver치s que funciona igual.</p>
<p>Tras darle al bot칩n de <em>Conectar</em>, nos saltar치 un aviso a prop칩sito del certificado, le damos a aceptar puesto que no entra침a peligro ya que lo hemos generado nosotros mismos:</p>
<p><img alt="" src="../P4_2/P4_2_12.png" /></p>
<p>Nos conectaremos directamente a la carpeta que le hab칤amos indicado en el archivo de configuraci칩n <code>/home/userftp/ftp</code></p>
<h2 id="sftp-ssh-file-transfer-protocol">SFTP (SSH File Transfer Protocol)</h2>
<p>Ahora vamos a probar la conexi칩n por SFTP. Recuerda que para esta no necesitamos configurar vsftp de ninguna forma especial, as칤 que vamos a recuperar el fichero de configuraci칩n antes de configurar FTPS. Antes guardaremos el fichero de configuraci칩n con ftps activado por si queremos usarlo despu칠s.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>sudo<span class="w"> </span>cp<span class="w"> </span>/etc/vsftpd.conf<span class="w"> </span>/etc/vsftpd.conf.ftps
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>sudo<span class="w"> </span>cp<span class="w"> </span>/etc/vsftpd.conf.backup2<span class="w"> </span>/etc/vsftpd.conf
</code></pre></div>
<p>Ahora recuerda que aqu칤 primero se establece una conexi칩n ssh entre el usuario y el servidor ssh usando las claves p칰blica y privada del usuario. Vamos a usar en este caso el usuario <code>user2</code>. Puedes crear un par de claves p칰blica y privada para este usuario como hicimos en la pr치ctica 1.3 y configurar el servidor ssh en la m치quina virtual en AWS para que user2 pueda conectarse con ssh usando su clave privada. </p>
<p>Cuando lo tengas, lo primero es probar que funciona antes de intentar la conexi칩n SFTP.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>ssh<span class="w"> </span>-i<span class="w"> </span>clave<span class="w"> </span>user2@ipserver
</code></pre></div>
<p>Recuerda cambiar clave por el nombre y ruta del fichero de clave privada generado y ipserver por la ip p칰blica de tu servidor en AWS. </p>
<p>Una vez comprobado que funciona ya podemo intentar conectar por sftp.</p>
<h3 id="conexion-en-modo-comando">Conexi칩n en modo comando</h3>
<p>Probamos a conectarnos en modo comando.</p>
<p><img alt="" src="../P4_2/P4_2_8.png" /></p>
<p>Si todo va bien se establecer치 la conexi칩n sin pedirnos usuario ni contrase침a.</p>
<h3 id="conexion-en-modo-grafico">Conexion en modo gr치fico.</h3>
<p>Si lo que quisi칠ramos es conectarnos con Filezilla mediante la conexi칩n r치pida, bastar치 con seleccionar el puerto 22, que recordemos es el de ssh. Para que esto funcione el archivo de clave privada deber치 estar en la ubicaci칩n donde el sistema espera encontrarlo, en caso contrario no lo encontrar치 y nos dar치 error.</p>
<p><img alt="" src="../P4_2/P4_2_9.png" /></p>
<p>Si tenemos nuestro fichero con la clave privada de <code>user2</code> en otro sitio podemos crear una conexi칩n nueva as칤:</p>
<p><img alt="" src="../P4_2/P4_2_10.png" /></p>
<p>Fij치os que al utilizar las claves de SSH no se debe introducir la contrase침a, 칰nicamente el nombre de usuario.</p>
<p>Puesto que nos estamos conectando usando las claves FTP, nos sale el mismo aviso que nos sal칤a al conectarnos por primera vez por SSH a nuestra Debian, que aceptamos porque sabemos que no entra침a ning칰n peligro en este caso:</p>
<p><img alt="" src="../P4_2/P4_2_11.png" /></p>
<p>Y vemos que al ser una conexi칩n SSH, nos conecta al <code>home</code> del usuario, en lugar de a la carpeta <code>ftp</code>. A partir de aqu칤 ya proceder칤amos igual que en el otro caso.</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.top", "toc.integrate", "search.highlight", "content.code.annotate", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>