
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://laura-agut.github.io/Despliegue/Ud7%20CI-CD/Ud8_1_cicd/">
      
      
        <link rel="prev" href="../P8_1/">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>8.1 - CI/CD (Integraci√≥n y despliegue continuo) - Despliegue de aplicaciones web</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cicd-integracion-y-despliegue-continuo" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="Despliegue de aplicaciones web" class="md-header__button md-logo" aria-label="Despliegue de aplicaciones web" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Despliegue de aplicaciones web
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              8.1 - CI/CD (Integraci√≥n y despliegue continuo)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="Cambiar a modo oscuro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo oscuro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Cambiar a modo claro"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo claro" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="B√∫squeda" placeholder="B√∫squeda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando b√∫squeda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegaci√≥n" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Despliegue de aplicaciones web" class="md-nav__button md-logo" aria-label="Despliegue de aplicaciones web" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Despliegue de aplicaciones web
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Despliegue de aplicaciones web
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Ud0 Introduccion
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Ud0 Introduccion
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/Ud0_1Introalmodulo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.1. Introducci√≥n al m√≥dulo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/Ud0_2AWS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.2. Introducci√≥n a AWS Academy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/ejercicio-final-ebs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    üß™ Ejercicio final: modifica, prueba en local y despliega en Elastic Beanstalk
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pr√°cticas
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Pr√°cticas
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.1. Linux Server en AWSAcademy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.2 Windows Server en AWSAcademy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.3. Conceder acceso a un segundo administrador
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.4. Comandos b√°sicos Linux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ud0%20Introduccion/P0_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P0.5: Despliegue Java en AWS Elastic Beanstalk
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="cicd-integracion-y-despliegue-continuo">CI/CD (Integraci√≥n y despliegue continuo)</h1>
<div class="admonition note">
<p class="admonition-title">Informaci√≥n</p>
<p>Estos apuntes est√°n basados en gran medida en unos apuntes de <a href="https://github.com/JJ/CC/">Domingo Gallardo</a> y se distribuyen porque <a href="https://github.com/JJ/CC/blob/master/LICENSE">su licencia</a> as√≠ lo permite.</p>
</div>
<h2 id="continuous-delivery-cd">Continuous Delivery (CD)</h2>
<p>Una idea fundamental de las metodolog√≠as √°giles es entregar valor
frecuentemente para obtener una pronta retroalimentaci√≥n del
cliente. Para ello es necesario tener muy engrasados los procesos de
despliegue y puesta en producci√≥n del software. </p>
<p>Una de las formas que facilita la optimizaci√≥n de
la puesta en producci√≥n de software es la pr√°ctica de XP <a href="https://www.iebschool.com/blog/que-es-el-xp-programming-agile-scrum/">(<em>eXtreme Programming</em>)</a> de
<em>Integraci√≥n continua</em> (<em>Continuous Integration</em>). En esta pr√°ctica
los miembros del equipo integran sus commits diariamente en el
proyecto y en cada integraci√≥n se lanzan tests automatizados que
verifican que los cambios no introducen errores.</p>
<p>Adem√°s de esta pr√°ctica, debemos tener tambi√©n automatizados todos los
procesos de compilaci√≥n (<em>build</em>) y despliegue (<em>deployment</em>) de la
aplicaci√≥n en los distintos entornos de prueba. Esto es lo que se
denomina <em>Despliegue continuo</em> (<em>Continuous Deployment</em>). En esta
l√≠nea, se han popularizado herramientas como <em>Docker</em> o <em>Kubernetes</em>
que facilitan el despliegue del software y su automatizaci√≥n y cada
vez se demandan m√°s profesionales (denominados <em>DevOps</em>) con capacidad
de gestionar estos despliegues automatizados.</p>
<p>Y en los √∫ltimos a√±os se ha dado un paso m√°s all√° y se ha comenzado a
hablar de <em>Entrega continua</em> (<em>Continous Delivery</em> en ingl√©s) con la
idea de promover software que est√© listo en cualquier momento para
salir a producci√≥n.</p>
<p>En este tema veremos todos estos conceptos, con la idea de tomar un
primer contacto con todos ellos. Necesitar√≠amos un curso (o m√°s) para
verlos en profundidad. Intentaremos al menos conocer los conceptos
b√°sicos para poder seguir profundizando en alguno de ellos en el
futuro.</p>
<h2 id="el-problema-de-la-puesta-en-produccion">El problema de la puesta en producci√≥n</h2>
<p>En las empresas tradicionales no √°giles el proceso de subir a
producci√≥n una nueva versi√≥n es un proceso muy complicado y
estresante. Se hace pocas veces, cuatro o cinco veces al a√±o, durante
el fin de semana cuando todos los servicios est√°n parados.</p>
<p>El proceso de genera muchos trastornos y dolores de cabeza. El equipo
de operaciones tiene que estar pendiente del m√≥vil para detectar
posibles problemas y ca√≠das del sistema. Una vez puesto el software en
producci√≥n el equipo de desarrollo se dedicar√° continuamente a
corregir bugs y solucionar problemas detectados por los usuarios.</p>
<p>Esto no es √°gil. Esto no permite conseguir lo que hemos comentado
muchas veces de un ciclo corto de retroalimentaci√≥n para que el
cliente pueda probar r√°pidamente las nuevas caracter√≠sticas y se pueda
comprobar su valor. Recordemos que en ambientes inciertos y no
predecibles es fundamental poder validar con el cliente las nuevas
funcionalidades introducidas, para adaptarse y corregir posibles
errores.</p>
<p>La realizaci√≥n de entregas frecuentes tambi√©n permite minimizar el
riesgo. Todo el tiempo que estamos desarrollando algo sin ponerlo en
producci√≥n es un riesgo acumulado. Hasta que no est√° en producci√≥n y
ha sido aceptado por el cliente no sabemos si lo que estamos
desarrollando va a ser validado o no. Cuanto menos tardemos en
validarlo, menor ser√° el riesgo.</p>
<p>La siguiente figura est√° sacada de la charla de Eduardo Ferro
(<a href="https://twitter.com/eferro">@eferro</a>) <a href="https://youtu.be/hbggtXmQcf8?t=444">Continuous Delivery:
Germinando una cultura √°gil
moderna</a>. </p>
<p><img alt="" src="../Ud8_img/small-increments.jpg" style="width:500px" /></p>
<p>En la figura de la izquierda se entrega mucho valor de golpe y el
riesgo que se ha ido acumulando es mucho mayor que en la figura de la
derecha, en la que se entregan peque√±os incrementos de valor que
nos permiten tener una retroalimentaci√≥n m√°s r√°pida y adaptar mucho
mejor el producto a las necesidades de los clientes.</p>
<p><img alt="" src="../Ud8_img/raspberry-pi-embedded-systems.png" style="width:200px" /></p>
<p>El proceso de puesta en producci√≥n del software depende mucho del tipo
de software. En un extremo, por ejemplo, una p√°gina web se puede
cambiar modificando directamente el fichero HTML en la propia m√°quina
en la que se est√° ejecutando el servidor web. No hace falta ni
recompilar, ni reiniciar el servidor. En el otro extremo, un software
de control de una placa de un satelite espacial puede estar embebido
en el propio firmware de la placa y para realizar un cambio puede ser
necesario hasta volver a grabar y producir la placa.</p>
<p>En general, la mayor√≠a de sistemas software se encuentran entre ambos
extremos. Es importante analizar con detalle cu√°l es el proceso de
despliegue de nuestro software, cu√°nto tarda en subir a producci√≥n un
cambio de una l√≠nea de c√≥digo y cu√°les son los cuellos de botella en
el proceso.</p>
<!-- <Ud8_img/ src="/Ud8_img/ultima-milla.png" width="600px"/> -->
<p><img alt="" src="../Ud8_img/ultima-milla.png" style="width:600px" /></p>
<p>La denominada <em>ultima milla</em> consiste en los pasos necesarios para la
puesta en producci√≥n de nuestro sistema. De nada nos sirve tener un
equipo √°gil que hace iteraciones y reuniones con el cliente si despu√©s
tenemos un equipo de QA (<em>Quality Assurance</em>) con un 90% de pruebas
manuales y otro de operaciones que tiene que configurar manualmente
cualquier nuevo despliegue a producci√≥n y al que le cuesta dos d√≠as
revertir un despliegue fallido.</p>
<p>Debemos analizar cu√°l es nuestro proceso de release y hacer lo posible
por mejorarlo. Encontrar los cuellos de botella, reducir los tiempos,
automatizar todo lo que podamos. De forma que pasemos de un release
por trimestre a un release mensual. Y despu√©s a un release cada dos
semanas. Y despu√©s a un release semanal. Y despu√©s a un posible
release con cada posible cada cambio. Al final, como dice Eduardo
Ferro en la charla mencionada anteriormente, el tiempo de subir un
commit a producci√≥n debe ser de menos de 15 minutos y debemos de poder
automatizar el proceso de puesta en producci√≥n hasta el extremo que lo
podamos hacer a discreci√≥n, cuando queramos, √∫nicamente pulsando un
bot√≥n.</p>
<p>Un elemento central de todo el proceso de despliegue es la
configuraci√≥n de un pipeline de despliegue lo m√°s automatizada
posible.</p>
<!-- <Ud8_img/ src="/Ud8_img/deployment-pipeline.png" width="600px" /> -->
<p><img alt="" src="../Ud8_img/deployment-pipeline.png" style="width:600px" /></p>
<p>el pipeline representa todos los pasos necesarios que llevan el c√≥digo
fuente hasta producci√≥n. Lo veremos en detalle m√°s adelante, pero es
interesante adelantarla aqu√≠. En la imagen se puede ver:</p>
<ul>
<li><strong>Compilaci√≥n</strong> de todas las dependencias en binarios. En el caso de una
  aplicaci√≥n Java podr√≠amos tener dependencias
  externas (que no har√≠a falta compilar, s√≥lo descargarse) y
  dependencias de librer√≠as internas que s√≠ que estamos modificando y
  que deber√≠amos recompilar.</li>
<li><strong>Empaquetamiento</strong>, construcci√≥n de un √∫nico binario a partir de todos
  los binarios existentes. En el caso de una aplicaci√≥n Java, la fase
  de package (por ejemplo, realizada con Maven) generar√≠a un fichero
  WAR que podr√≠amos distribuir. Tambi√©n, si utilizamos Docker, en esta
  fase generaremos una m√°quina Docker que podremos distribuir.</li>
<li><strong>Despliegue</strong> en distintos
  <a href="https://en.wikipedia.org/wiki/Deployment_environment">entornos</a> de
  prueba y lanzamiento de pruebas en los distintos entornos. Cada
  entorno tiene su propia configuraci√≥n, definida por variables de
  entorno o par√°metros de los comandos de puesta en marcha.</li>
<li>Despliegue en entorno de <strong><em>staging</em></strong> (r√©plica muy similar al entorno de
  producci√≥n).</li>
<li>Despliegue en entorno de <strong>producci√≥n</strong>.</li>
</ul>
<p>En el enfoque de entrega continua el proceso anterior est√°
completamente automatizado y la puesta en producci√≥n se puede modular
y realizar en el momento que nos interese pulsando √∫nicamente un bot√≥n
en cualquier momento. </p>
<p>Recordemos que la forma m√°s tradicional de enfrentar el problema del
lanzamiento es separar una rama de release de la rama de desarrollo.</p>
<!-- <Ud8_img/ src="/Ud8_img/release-branch.jpg" width="600px"/> -->

<p><img alt="" src="../Ud8_img/release-branch.jpg" style="width:600px" /></p>
<p>Al separar la rama de release podemos seguir introduciendo cambios en
la rama de desarrollo sin afectar para nada al release. En la rama de
release se realiza todo el pipeline de despliegue y se prueba en todos
los entornos. Se introducen correcciones de peque√±os bugs encontrados
y se tambi√©n se puede incluir alg√∫n commit escogido de la rama de
desarrollo haciendo un <code>cherry-pick</code>. Finalmente, la √∫ltima versi√≥n
comprobada se pasa a producci√≥n y mezcla con la rama de releases y con
la de desarrollo.</p>
<p>En el enfoque de lanzamiento continuo no existen ramas de release,
sino que en cualquier commit de la rama principal es candidato a ser
puesto en producci√≥n. </p>
<!-- <Ud8_img/ src="/Ud8_img/continuous-delivery.png" width="600px"/> -->
<p><img alt="" src="../Ud8_img/continuous-delivery.png" style="width:600px" /></p>
<h2 id="integracion-continua">Integraci√≥n continua</h2>
<p>La Integraci√≥n continua es una pr√°ctica en la que los miembros del
equipo integran su trabajo frecuentemente en el proyecto. Se trata de
una pr√°ctica de XP (eXtreme Programming) en la que se recomienda que cada miembro integre
sus cambios diariamente. Esto lleva a m√∫ltiples integraciones cada
d√≠a. Cada integraci√≥n es verificada por una compilaci√≥n autom√°tica
(<em>automated build</em>) en la que se lanzan todos los tests y se detectan
errores lo m√°s r√°pidamente posible.</p>
<p>Esta pr√°ctica obliga a que todos los cambios realizados por los
desarrolladores sean puestos en com√∫n continuamente, lo que promueve
la compartici√≥n de conocimiento entre todos los miembros del
equipo. Cuando una persona va a integrar sus cambios primero debe
comprobar que √©stos son compatibles con los cambios que ha habido en
el proyecto. Como se integra diariamente, √©stos no ser√°n demasiados y
si hay alg√∫n error ser√° f√°cil de solucionar.</p>
<p>Sin embargo, si se desarrolla una versi√≥n separada que tarda mucho en
integrarse ser√° muy posible que cuando se realice la integraci√≥n
surjan muchos problemas de m√°s dif√≠cil soluci√≥n.</p>
<h3 id="trunk-based-vs-feature-branches">Trunk based vs. feature branches</h3>
<p>Uno de los debates frecuentes relacionados con los flujos de trabajo
de Git es si es m√°s conveniente un flujo de trabajo <em>trunk based</em>
(basado en la rama principal) o uno con <em>feature branches</em> (ramas de
caracter√≠sticas).</p>
<!-- <Ud8_img/ src="/Ud8_img/trunk-feature.png" width="500px"/> -->
<p><img alt="" src="../Ud8_img/trunk-feature.png" style="width:600px" /></p>
<p>La imagen anterior est√° tambi√©n sacada de la charla de Eduardo
Ferro. En ella se muestran los dos flujos de trabajo y se muestran
parejas de desarrolladores porque est√°n aplicando tambi√©n<a href="https://www.ionos.es/digitalguide/paginas-web/desarrollo-web/pair-programming/"> <em>pair
programming</em></a>.</p>
<p>En el <strong>flujo de desarrollo <em>trunk based</em></strong> todos los desarrolladores
publican sus commits continuamente (al menos una vez al d√≠a) sobre la
rama principal del proyecto. Esto obliga a mantenerse continuamente al
d√≠a sobre los cambios que otros est√°n introduciendo y a tener cuidado
de que nuestros cambios vayan en la misma direcci√≥n.</p>
<p>El desarrollador actualiza su repositorio local y comienza a programar
un peque√±o incremento (c√≥digo y tests). Cuando termina lanza todos los
tests para asegurarse de que no se ha roto nada. Antes de publicar los
cambios, vuelve a actualizar el repositorio local con los nuevos
cambios que se han a√±adido a la rama principal y vuelve a lanzar los
tests. Si todo funciona bien, publica los cambios en el repositorio
compartido.</p>
<p>Entre las ventajas de esta t√©cnica se encuentran:</p>
<ul>
<li>La integraci√≥n de un nuevo commit es f√°cil porque la rama principal
  ha cambiado poco desde el commit anterior que integramos. No ha
  habido demasiado tiempo para que el proyecto diverja mucho.</li>
<li>La transparencia en los cambios hace que se detecten antes los
  errores</li>
<li>El conocimiento del equipo evoluciona conjuntamente. Todo el mundo
  tiene informaci√≥n actualizada a diario de los cambios que se van
  introduciendo en el proyecto.</li>
<li>Obliga a dividir los cambios grandes en cambios peque√±os que se van
  integrando poco a poco. Esto obliga a hacer un mayor esfuerzo de
  dise√±o y utilizar mejores arquitecturas de software.</li>
</ul>
<p>Entre los inconvenientes podemos destacar:</p>
<ul>
<li>Interrupciones m√°s frecuentes en el flujo de trabajo del equipo
  debido a problemas introducidos por malos commits.</li>
<li>No se pueden hacer pull requests en los que se haga una revisi√≥n de
  c√≥digo.</li>
<li>Necesidad m√°s frecuente de <em>reverts</em> que corrigen equivocaciones.</li>
<li>Obliga al equipo a una gran disciplina y a una gran madurez. No se
  deben buscar culpables por los errores introducidos. Los errores
  nos hacen aprender.</li>
</ul>
<p>El <strong>flujo de desarrollo de ramas de caracter√≠sticas</strong> se basa en separar ramas de caracter√≠sticas
de la rama principal. En cada rama de caracter√≠stica se desarrolla una
caracter√≠stica y se integra en la rama principal cuando est√©
terminada. Esta integraci√≥n se puede hacer usando un pull request.</p>
<p>Ventajas:</p>
<ul>
<li>Se integran en la rama principal cambios completos.</li>
<li>Durante el desarrollo de la caracter√≠stica puedes aislarte del resto
  del desarrollo del proyecto y centrarte √∫nicamente en la
  caracter√≠stica que est√°s desarrollando.</li>
<li>Los fallos son locales a la rama. Un fallo no afecta al resto del
  equipo. Puedes tomarte un tiempo en arreglar el fallo sin que el
  resto del equipo se quede bloqueado.</li>
<li>Posibilidad de usar pull requests y realizar revisiones de c√≥digo.</li>
</ul>
<p>Inconvenientes:</p>
<ul>
<li>Si las ramas tienen una duraci√≥n muy larga el proyecto puede haberse
  modificado mucho cuando vayamos a hacer la integraci√≥n, haci√©ndola
  bastante complicada.</li>
<li>El conocimiento compartido sobre el c√≥digo del proyecto es mucho
  menor y se limita a los posibles conflictos que podemos tener en la
  rama que hemos desarrollado.</li>
<li>El primero que integra su rama no tiene problemas, los problemas los
  tienen las siguientes integraciones. Esto crea un efecto perverso en
  el que intentamos ser los primeros posiblemente a costa de menos
  calidad en el c√≥digo.</li>
</ul>
<p>Posiblemente, la mejor opci√≥n sea comenzar con ramas de
caracter√≠sticas e ir haci√©ndolas cada vez m√°s cortas, de forma que se
integren cada dos o tres d√≠as como m√°ximo. Al igual que en el enfoque
de <em>trunk based</em> podr√≠an no ser caracter√≠sticas completas, sino
peque√±os incrementos. Por ejemplo, una rama
podr√≠a contener la parte de backend de la caracter√≠stica y despu√©s
har√≠amos la de frontend. Y cuando el equipo se acostumbre a hacer ramas
cada vez m√°s peque√±as, podr√≠amos plantearnos la opci√≥n de pasar a un
modelo basado en trunk.</p>
<h3 id="herramientas-de-integracion-continua">Herramientas de integraci√≥n continua</h3>
<p>Una de las caracter√≠sticas fundamentales de la integraci√≥n continua es
que cada vez que se integra un commit en la rama principal se debe
realizar una construcci√≥n autom√°tica del proyecto, lanz√°ndose todos
los tests en el entorno de integraci√≥n continua y construy√©ndose el
binario candidato a desplegar en producci√≥n.</p>
<p>La forma de realizar esto es mediante las denominadas herramientas de
integraci√≥n continua.</p>
<!-- <Ud8_img/ src="/Ud8_img/ci-tools.png" width="500px"/> -->
<p><img alt="" src="../Ud8_img/ci-tools.png" style="width:500px" /></p>
<p>Podemos elegir como herramientas de integraci√≥n continua una
herramienta que instalamos en nuestros propios servidores de
integraci√≥n (<em>CI server</em>) o construcci√≥n continua (<em>continuous build
server</em>) como <a href="https://www.jenkins.io">Jenkins</a> o tambi√©n en un
servicio en la nube como <a href="https://github.com/features/actions">GitHub
Actions</a>.</p>
<p>Cualquiera de estas herramientas permiten automatizar el lanzamiento
de tests y la compilaci√≥n autom√°tica de la aplicaci√≥n y la generaci√≥n
de una aplicaci√≥n distribuible. Esta aplicaci√≥n puede ser un binario,
un JAR o WAR, una m√°quina Docker, etc. que puede ser desplegada en
distintos entornos, incluido el de producci√≥n.</p>
<!-- <Ud8_img/ src="/Ud8_img/integration-server.jpg" width="700px"/> -->
<p><img alt="" src="../Ud8_img/integration-server.jpg" style="width:700px" /></p>
<p>El servicio de integraci√≥n continua genera tambi√©n notificaciones
autom√°ticas a todos los miembros del equipo indicando el estado de la
compilaci√≥n. Tambi√©n suele proporcionar un panel de control con la
indicaci√≥n del estado de cada build.</p>
<!-- 
<Ud8_img/ src="/Ud8_img/jenkins-panel.gif" width="700px"/> -->
<p><img alt="" src="../Ud8_img/jenkins-panel.gif" style="width:700px" /></p>
<h3 id="generacion-del-ejecutable">Generaci√≥n del ejecutable</h3>
<p>El resultado de la compilaci√≥n autom√°tica realizada por el servidor de
integraci√≥n continua debe ser un artefacto desplegable en los
distintos entornos en los que vamos a probar la aplicaci√≥n. La
aplicaci√≥n s√≥lo se debe compilar una √∫nica vez y el resultado debe
almacenarse en un sitio accesible por cualquier proceso y miembro del
equipo.</p>
<p>Es fundamental que las herramientas usadas para construir la
aplicaci√≥n puedan ser usadas desde l√≠nea de comando. De esta forma es
mucho m√°s sencillo adaptar y configurar distintos tipos de scripts de
compilaci√≥n (<em>build scripts</em>). Entre las herramientas m√°s usadas
destacamos las siguientes:</p>
<ul>
<li>Make (C, Unix)</li>
<li>Rake (Ruby) </li>
<li>Maven (Java)</li>
<li>Gradle (Java, Scala, etc.)</li>
<li>sbt (Scala, Play Framework)</li>
</ul>
<p>Igual que hay distintas herramientas de compilaci√≥n para los
diferentes lenguajes de programaci√≥n, existen diferentes formatos en
los que se guardan los artefactos binarios resultantes de la
compilaci√≥n. </p>
<!-- <Ud8_img/ src="/Ud8_img/artefacto-jar.png" width="300px"/> -->
<p><img alt="" src="../Ud8_img/artefacto-jar.png" style="width:300px" /></p>
<p>Por ejemplo, el binario resultante de una aplicaci√≥n C es
un fichero compilado que se ejecutar√° en el sistema operativo para el
que haya sido compilada la aplicaci√≥n, mientras que el resultante de
una aplicaci√≥n Java es un fichero JAR que podremos desplegar en
cualquier m√°quina en la que tengamos instalado un JRE (<em>Java Runtime
Environment</em>).</p>
<p>Adem√°s tenemos el problema a√±adido de generaci√≥n de distintos binarios
para diferentes sistemas operativos. Por ejemplo, si estamos
desarrollando una aplicaci√≥n de escritorio que va a funcionar en
Windows, Linux y Mac deberemos generar los binarios correspondientes a
esas distintas plataformas y despu√©s testearlos de forma autom√°tica en
distintos ordenadores cada uno con su sistema operativo
espec√≠fico.</p>
<p>En la actualidad se est√° haciendo cada vez m√°s popular la utilizaci√≥n
de im√°genes <a href="https://www.docker.com">Docker</a> como artefacto binario a
distribuir y ejecutar. </p>
<!-- <Ud8_img/ src="/Ud8_img/docker-images.webp" /> -->
<p><img alt="" src="../Ud8_img/docker-images.webp" /></p>
<p>Entre las ventajas de este enfoque se
encuentran el ser multiplaforma (para ejecutarlas basta con tener
instalado el <em>Docker Engine</em>) y que los contenedores (servicios en
ejecuci√≥n) se pueden configurar y combinar o ejecutar en clusters
usando herramientas como <a href="https://kubernetes.io">Kubernetes</a>.</p>
<p>Es una buena pr√°ctica darle a cada artefacto binario compilado un
nombre distinto en el que aparezca el n√∫mero de versi√≥n. En el caso de
la integraci√≥n continua, normalmente se le da al binario un nombre en
el que aparece la fecha e incluso la hora de la compilaci√≥n. De esta
forma, las distintas compilaciones pueden ser identificadas de forma
√∫nica. </p>
<p>En el caso en que nuestra aplicaci√≥n dependa de paquetes externos es
conveniente descargarlos y almacenarlos en un sitio centralizado de
forma que no tengan que descargarse de Internet cada vez que se
realiza una nueva compilaci√≥n. Para ello es conveniente configurar
correctamente las cach√©s del sistema de build que estemos utilizando.</p>
<p>La aplicaci√≥n desplegable debe consistir en un √∫nico artefacto con el
nombre correcto que contenga todo lo necesario para ejecutarse en
distintos entornos de prueba y pueda ser puesto en producci√≥n. El
artefacto debe almacenarse en un lugar centralizado, accesible desde
los distintos entornos de forma autom√°tica. Por ejemplo, podemos usar
un servidor web local y dejar el fichero en una URL concreta.</p>
<h3 id="principios-y-practicas-de-integracion-continua">Principios y pr√°cticas de integraci√≥n continua</h3>
<p>A continuaci√≥n presentamos en forma de √≠tems un resumen de los
elementos importantes de la integraci√≥n continua que hemos visto hasta
ahora.</p>
<ul>
<li>Desarrollo de c√≥digo<ul>
<li>El sistema debe siempre poder ser construido (build) y probado
con √©xito. </li>
<li>Todo el mundo hace merge de los cambios con frecuencia.</li>
<li>Despu√©s de cada commit, el sistema se integra inmediata y autom√°ticamente.</li>
<li>Se desarrolla el sistema en peque√±os incrementos.</li>
</ul>
</li>
<li>Testing<ul>
<li>Los desarrolladores prueban su c√≥digo en sus espacios de trabajo
privados. </li>
<li>Despu√©s mezclan los cambios en el repositorio.</li>
</ul>
</li>
<li>Servidor de integraci√≥n continua (CI server):<ul>
<li>Monitoriza el repositorio y comprueba los cambios cuando
ocurren.</li>
<li>Construye el sistema y ejecuta las pruebas unitarias y de
integraci√≥n.</li>
<li>Informa al equipo de la construcci√≥n con √©xito o de los fallos.</li>
</ul>
</li>
<li>Errores en los build<ul>
<li>El equipo arregla el problema lo antes posible.</li>
<li>Continuar para integrar y probar continuamente durante todo el
  proyecto. </li>
</ul>
</li>
<li>El √∫ltimo ejecutable compilado debe estar f√°cilmente disponible<ul>
<li>El resultado de la compilaci√≥n debe ser un artefacto ejecutable
  disponible para desplegar en distintos entornos, incluso en
  producci√≥n.</li>
</ul>
</li>
</ul>
<h2 id="configuracion-del-despliegue">Configuraci√≥n del despliegue</h2>
<p>Para hacer integraci√≥n continua es necesario tener m√∫ltiples
entornos. En el entorno de trabajo del desarrollador se pueden lanzar
los tests m√°s r√°pidos y utilizar una
configuraci√≥n en la que usemos una base de datos en memoria (como H2)
que acelere la velocidad de los tests que utilicen base de datos.</p>
<p>Se puede configurar un primer entorno de integraci√≥n continua para que
se ejecuten en √©l tests m√°s lentos y con una configuraci√≥n m√°s
parecida a la del entorno de producci√≥n. Por ejemplo, se puede
utilizar una configuraci√≥n en la que se utilice una base de datos
similar a la que se usa en producci√≥n, poblada con datos de prueba. En
este entorno se deben lanzar los tests r√°pidos y tambi√©n tests m√°s
lentos de integraci√≥n.</p>
<p>Y despu√©s tendremos otros entornos cada vez m√°s similares al entorno
de producci√≥n en los que tambi√©n se realizar√°n todos los tests
autom√°ticos y otros tests manuales necesarios para tener la
confirmaci√≥n de que todo est√° funcionando correctamente.</p>
<p>En todos estos entornos deberemos instalar la misma aplicaci√≥n
compilada, y tendremos que modificar en cada caso su configuraci√≥n. Es
importante tener la capacidad de automatizar tanto la gesti√≥n de
entornos de despliegue (arrancar las bases de datos correctas,
configurar puertos, etc.) como la instalaci√≥n y ejecuci√≥n de la
aplicaci√≥n en el entorno.</p>
<p>Antiguamente los distintos entornos eran m√°quinas f√≠sicas distintas,
con configuraciones distintas previamente instaladas en cada una de
ellas. Hoy en d√≠a es mucho m√°s com√∫n utilizar entornos virtuales
f√°cilmente construibles a partir de scripts y c√≥digo usando
herramientas de virtualizaci√≥n como Docker, Kubernetes, etc. Tambi√©n
es habitual la utilizaci√≥n de entornos en la nube (Heroku, GitHub
Actions, Amazon Web Services, etc.) tanto para prueba como para
producci√≥n.</p>
<h3 id="entornos-de-despliegue">Entornos de despliegue</h3>
<p>Podemos diferenciar diferentes tipos de entornos (configuraci√≥n de
servicios y servidores) en los que se despliega y prueba el build de
la aplicaci√≥n. En general, ordenados de menor a mayor parecido a
producci√≥n, podemos diferenciar.</p>
<ul>
<li><strong>Local</strong>: ordenador del desarrollador. Se ejecutan tests unitarios
de la caracter√≠stica que se est√° desarrollando. </li>
<li><strong>Desarrollo/Trunk/Master</strong>: ordenador de integraci√≥n continua conectado
a la rama de desarrollo en el que se ejecutan todos los tests
unitarios continuamente. </li>
<li><strong>Integraci√≥n</strong>: Entorno en el que se sustituyen los mocks y bases de
datos de memoria por servicios reales, aunque con copias parciales de
los datos de producci√≥n.</li>
<li><strong>Test/QA</strong>: Entornos en los que se realizan pruebas funcionales, de interfaz de usuario, de performance o de seguridad, entre otros. Pueden ser manuales y/o automatizados.</li>
<li><strong>Stage/Preproducci√≥n</strong>: Entorno id√©ntico al de producci√≥n en el que se
hace la √∫ltima validaci√≥n de la nueva versi√≥n a desplegar a
producci√≥n. Copia de la base de datos de producci√≥n y con servidores
similares a los de producci√≥n, para poder comprobar rendimiento.</li>
<li><strong>Producci√≥n</strong>: Entorno que usan los clientes reales de la aplicaci√≥n.</li>
</ul>
<h3 id="configuracion-de-la-aplicacion">Configuraci√≥n de la aplicaci√≥n</h3>
<p>La aplicaci√≥n debe poder funcionar en distintos entornos sin tener que
ser recompilada. Para ello es necesario poder configurar su
funcionamiento definiendo par√°metros que podamos modificar previamente
a su ejecuci√≥n sin tener que recompilarla.</p>
<p>Existen multitud de elementos que podemos necesitar configurar
dependiendo del entorno en que queremos que funcione la
aplicaci√≥n. Por ejemplo:</p>
<ul>
<li>URL de conexi√≥n a la base de datos</li>
<li>Usuario y contrase√±a de conexi√≥n a la base de datos</li>
<li>Puerto en el que la aplicaci√≥n va a recibir las peticiones</li>
<li>Direcciones de los servicios a los que debe conectarse (por ejemplo,
  servicio SMTP de correo electr√≥nico)</li>
</ul>
<p>En cada entorno en los que va a funcionar la aplicaci√≥n estos
par√°metros van a tener unos valores distintos que hay que pasarle a la
aplicaci√≥n cuando se ponga en funcionamiento. </p>
<p>Existen diversas formas de definir estas propiedades. Las m√°s usuales son:</p>
<ul>
<li>Mediante ficheros de configuraci√≥n de la aplicaci√≥n.</li>
<li>Mediante variables de entorno cuyos valores establecemos con scripts
  antes de lanzar la aplicaci√≥n.</li>
<li>Mediante argumentos del comando que lanza la aplicaci√≥n</li>
</ul>
<p>Estas distintas configuraciones deben estar tambi√©n guardadas en el
control de versiones, igual que el c√≥digo de la aplicaci√≥n, para poder
tambi√©n controlar su evoluci√≥n y sus cambios.</p>
<h4 id="configuracion-de-imagenes-docker">Configuraci√≥n de im√°genes Docker</h4>
<p>Docker tambi√©n tiene muchas estrategias que permiten configurar la
ejecuci√≥n de una imagen. Una de las m√°s utilizadas es hacer que la
imagen utilice variables de entorno que pueden ser modificadas en
al lanzar el contenedor. Para ello debemos definir en la imagen estas
variables con el comando <code>ENV</code>, pudiendo dar valores por defecto.</p>
<p>Por ejemplo, podemos definir el siguiente <code>Dockerfile</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>FROM alpine
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>ENV saludo=&quot;Hola, mundo!&quot;
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>CMD echo $saludo
</code></pre></div>
<p>Creamos la imagen:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>$ docker build -t saludo .
</code></pre></div>
<p>Si lanzamos la imagen muestra el saludo por defecto:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>$ docker run saludo
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>Hola, mundo!
</code></pre></div>
<p>Y podemos configurar el saludo de varias formas. Por ejemplo,
indicando el valor del par√°metro al hacer <code>run</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>$ docker run -e &quot;saludo=¬øQu√© tal est√°s?&quot; saludo
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>¬øQu√© tal est√°s?
</code></pre></div>
<p>O guardando el valor del par√°metro en un fichero de propiedades que
pasamos al ejecutar la imagen. Por ejemplo, en el fichero
<code>propiedades.txt</code> escribimos lo siguiente:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>saludo=¬øQu√© passsa, colega?
</code></pre></div>
<p>Y ejecutamos la imagen de la siguiente forma:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>$ docker run --env-file=propiedades.txt saludo
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>¬øQu√© passsa, colega?
</code></pre></div>
<h2 id="entrega-continua">Entrega continua</h2>
<p>El concepto de Entrega continua (<em>Continuous Delivery</em>) es una
extensi√≥n de la Integraci√≥n continua que se populariz√≥ a ra√≠z del
libro que publicaron en 2010 Jez Humble y David Farley (ver las referencias).</p>
<!-- <Ud8_img/ src="/Ud8_img/continuous-delivery.jpg" width="200px"/> -->
<p><img alt="" src="../Ud8_img/continuous-delivery.jpg" style="width:200px" /></p>
<p>Es un concepto que parte de la integraci√≥n continua para llegar a una
automatizaci√≥n completa de la puesta en producci√≥n. El objetivo es
conseguir una puesta en producci√≥n (release) del software:</p>
<ul>
<li>Poco arriesgada</li>
<li>Frecuente</li>
<li>Barata</li>
<li>R√°pida</li>
<li>Predecible</li>
<li>Reproducible</li>
</ul>
<p>En palabras de Jez Humble, la entrega continua consiste en:</p>
<blockquote>
<p>‚ÄúReduce the cost, time, and risk of delivering incremental changes
to users‚Äù</p>
<p>Jez Humble (2013), Charla <a href="https://vimeo.com/68320415">Adopting Continuous Delivery</a></p>
</blockquote>
<p>Otra frase muy importante, que ya hemos comentado alguna vez:</p>
<blockquote>
<p>‚ÄúHow long would it take your organization to deploy a change that
involved just one single line of code? Do you do this on a
repeatable, reliable basis?‚Äù </p>
<p>Mary Poppendieck</p>
</blockquote>
<p>Algunas t√©cnicas que se utilizan en la Entrega continua (muchas de ellas ya las hemos visto):</p>
<ul>
<li>Peque√±os cambios que se despliegan continuamente</li>
<li>Todos los builds son candidatos al release </li>
<li>Todo en el control de versiones (se debe poder probar cualquier release)</li>
<li>Pipelines de despliegue (deployment pipelines) </li>
<li>Integraci√≥n continua: automatizaci√≥n de builds, tests, despliegues, entornos</li>
</ul>
<h3 id="pipeline-de-despliegue">Pipeline de despliegue</h3>
<p>Tal y como hemos comentado cuando habl√°bamos de integraci√≥n continua,
un elemento central es de la automatizaci√≥n es el pipeline de
despliegue. un pipeline de despliegue es una implementaci√≥n
automatizada del proceso de construcci√≥n, despliegue, prueba y
lanzamiento de nuestro sistema.</p>
<p>La utilizaci√≥n de un pipeline de despliegue garantiza la visibilidad
de todo el proceso, lo que garantiza un feedback temprano y un control
continuo del mismo.</p>
<p>Explicaci√≥n del libro de Jeff Humble:</p>
<blockquote>
<p>Cada cambio que se realiza sobre la configuraci√≥n de la aplicaci√≥n, su
c√≥digo fuente o sus datos, lanza la creaci√≥n de una nueva instancia de
el pipeline. Uno de los primeros pasos en el pipeline es crear los
binarios y los instaladores. El resto de el pipeline ejecuta una serie
de tests sobre los binarios para probar que pueden ser lanzados. Cada
test que pasa el candidato a release nos da m√°s confianza de que
funcionar√° correctamente esta combinaci√≥n particular de c√≥digo
binario, informaci√≥n de configuraci√≥n, entorno y datos. Si el
candidato a release pasa todos los tests, puede ser lanzado.</p>
</blockquote>
<p>En el libro de Humble y Farley se muestra el siguiente
esquema que representa sus distintos elementos.</p>
<!-- <Ud8_img/ src="/Ud8_img/tuberia-despliegue.png" width="700px"/> -->
<p><img alt="" src="../Ud8_img/tuberia-despliegue.png" style="width:700px" /></p>
<ul>
<li>En la parte superior se muestra el sistema de control de versiones,
  en donde se almacena el c√≥digo del proyecto y los datos de las
  distintas configuraciones de los entornos y de la aplicaci√≥n. Las
  configuraciones de los entornos y de la aplicaci√≥n se deben guardar
  en el sistema de control de versiones para gestionar su evoluci√≥n y
  modificaci√≥n de la misma forma que gestionamos la evoluci√≥n del
  c√≥digo.</li>
<li>En la parte inferior se muestra el repositorio de artefactos en
  donde se almacenan los binarios de la aplicaci√≥n. Puede ser, por
  ejemplo, Docker Hub en el caso de ser una aplicaci√≥n dockerizada.</li>
<li>En la fase de commit el c√≥digo se compila y se lanzan los tests
  unitarios. Se generan los binarios que se almacenan en el
  repositorio de artefactos.</li>
<li>En la fase de aceptaci√≥n se configuran y despliegan los binarios en
  un entorno similar al de producci√≥n. Se realizan test de
  aceptaci√≥n/integraci√≥n y se valida la aplicaci√≥n y se deja lista para ser
  publicada a producci√≥n por parte de Operaciones.</li>
<li>En la fase de UAT (User Acceptance Testing) se realizan pruebas
  manuales en un entorno lo m√°s parecido posible al de producci√≥n.</li>
<li>En la fase capacidad se realizan tests de rendimiento.</li>
<li>El binario se despliega en producci√≥n si todas las fases anteriores
  se pasan con √©xito.</li>
</ul>
<p>En la siguiente figura se muestra un ejemplo de posible secuencia de
despliegue:</p>
<!-- <Ud8_img/ src="/Ud8_img/fases-tuber√≠a.jpg" width="600px"/> -->
<p><img alt="" src="../Ud8_img/fases-tuberia.jpg" style="width:600px" /></p>
<p>Son muy √∫tiles los tableros de control de el pipeline de despliegue,
como por ejemplo el que proporciona Jenkins.</p>
<!-- <Ud8_img/ src="/Ud8_img/pipeline-dashboard.png" width="600px"/> -->
<p><img alt="" src="../Ud8_img/pipeline-dashboard.png" style="width:600px" /></p>
<h3 id="pequenos-cambios">Peque√±os cambios</h3>
<p>Tal y como hemos comentado en la introducci√≥n del tema, una
pr√°ctica fundamental de los equipos que utilizan las t√©cnicas de
entrega continua es subir a producci√≥n continuamente peque√±os cambios
con los que se van introduciendo poco a poco las nuevas
funcionalidades.</p>
<!-- <Ud8_img/ src="/Ud8_img/deploy-carto.png" width="800px" /> -->
<p><img alt="" src="../Ud8_img/deploy-carto.png" style="width:800px" /></p>
<p>Por ejemplo, en la charla de Juan Ignacio S√°nchez <a href="https://www.slideshare.net/juanignaciosl/continuous-integration-at-cartodb-march-16">Continuous
Integration at
CartoDB</a>
(<a href="https://www.youtube.com/watch?v=fRB_rlUtxys">v√≠deo</a>) se explica c√≥mo
es el proceso de integraci√≥n continua en <a href="https://carto.com">Carto</a>, una importante
empresa espa√±ola de gesti√≥n de datos geogr√°ficos.</p>
<p>Algunas de las m√©tricas que muestra en la charla reflejan claramente
cu√°l es el funcionamiento de la integraci√≥n continua en la empresa. Su
producto opensource m√°s importante es CartoDB (enlace a su
<a href="https://github.com/CartoDB/cartodb">repositorio GitHub</a>). En la √©poca
de la charla el producto integraba una media de 22 pull requests
semanales y 15 despliegues en producci√≥n.</p>
<p>Si todos los cambios son peque√±os, ¬øc√≥mo se introducen los cambios
grandes en el proyecto?. Por ejemplo, nuevas caracter√≠sticas complejas
en las que se necesitan combinar distintas funcionalidades
elementales.</p>
<p>Es posible ir desarrollando, probando y colocando las piezas en el
c√≥digo (sin mostrar en la interfaz de usuario) para que el sistema
evolucione hacia un momento futuro en sea f√°cil introducir una
caracter√≠stica totalmente nueva mediante un peque√±o cambio. Como dice
Kent Beck:</p>
<blockquote>
<p>Make the change easy, then make the easy change.</p>
</blockquote>
<p>Para ello podemos usar las siguientes estrategias:</p>
<ul>
<li>Codificaci√≥n y prueba de las peque√±as funcionalidades por separado.</li>
<li>Buen dise√±o de c√≥digo, por ejemplo seleccionar una implementaci√≥n
  concreta utilizando interfaces y factor√≠as, pero dejar la estructura
  lista para introducir futuros cambios.</li>
<li>Peque√±os cambios en las APIs compatibles con los tests de
  regresi√≥n.</li>
<li>Uso de mocks.</li>
<li>Interruptores de caracter√≠sticas.</li>
</ul>
<!-- <Ud8_img/ src="/Ud8_img/feature-toggle.jpeg" width="600px" /> -->
<p><img alt="" src="../Ud8_img/feature-toggle.jpeg" style="width:600px" /></p>
<p>Esta √∫ltima t√©cnica es muy interesante. Consiste en definir
interruptores o flags booleanos en el c√≥digo que hagan que ciertas
caracter√≠sticas se muestren o no en la aplicaci√≥n dependiendo de si
los flags est√°n o no activos.</p>
<p>En <a href="https://martinfowler.com/articles/feature-toggles.html">este
art√≠culo</a> se
puede encontrar una explicaci√≥n en profundidad de m√∫ltiples t√©cnicas
usadas para implementar los interruptores de
caracter√≠sticas. Dependiendo de la t√©cnica es posible hasta definir
interruptores que se puedan modificar en tiempo de ejecuci√≥n e incluso
que se puedan mostrar o no la funcionalidad a seg√∫n qu√© usuarios
implementando un sistema de <em>canary release</em>. </p>
<h3 id="canary-release">Canary release</h3>
<!-- <Ud8_img/ src="/Ud8_img/canary-releases.jpg" /> -->
<p><img alt="" src="../Ud8_img/canary-releases.jpg" style="width:600px" /></p>
<p>La idea del <a href="https://martinfowler.com/bliki/CanaryRelease.html"><em>canary
release</em></a> consiste
en configurar un sistema de despliegue que permita mantener
simult√°neamente en producci√≥n dos versiones de la aplicaci√≥n. En el caso
de una aplicaci√≥n web, podr√≠amos configurar un proxy o router
intermedio que se encargue de encauzar las peticiones de los usuarios
a una versi√≥n de la aplicaci√≥n o a otra.</p>
<p>Cuando se lanza una caracter√≠stica nueva se puede configurar el proxy
para que s√≥lo sea probada por una peque√±a cantidad de usuarios y
detectar posibles errores en este despliegue reducido. Cuando se haya
comprobado con este peque√±o grupo que todo funciona correctamente se
modifica la configuraci√≥n del proxy para que todos accedan a la nueva
versi√≥n.</p>
<p>La configuraci√≥n del proxy puede llegar a ser bastante compleja,
haciendo el filtro de usuarios en funci√≥n de par√°metros que nos
interesen (localizaci√≥n, tipo de usuario, etc.).</p>
<p>Este sistema tambi√©n puede utilizarse, junto con el de interruptores
de caracter√≠sticas, para realizar <a href="https://en.wikipedia.org/wiki/A/B_testing">pruebas
A/B</a> de nuevas
caracter√≠sticas.</p>
<h3 id="devops">DevOps</h3>
<!-- <Ud8_img/ src="/Ud8_img/devops.webp" width="600px"/> -->
<p><img alt="" src="../Ud8_img/devops.webp" style="width:600px" /></p>
<p>Tradicionalmente el trabajo de los desarrolladores y el de los
t√©cnicos de operaciones (responsables de la puesta en producci√≥n del
sistema, monitorizaci√≥n de servidores, etc. ) son contrapuestos.</p>
<ul>
<li><strong>Dev</strong>elopers:<ul>
<li>Su trabajo es a√±adir nuevas caracter√≠sticas.</li>
<li>Trabajan en entornos locales (‚Äúen mi m√°quina funciona‚Äù).</li>
<li>Utilizan herramientas y lenguajes que permiten abstraer y automatizar.</li>
</ul>
</li>
<li><strong>Op</strong>erations: <ul>
<li>Su trabajo es mantener el sitio web seguro, estable y r√°pido.</li>
<li>Detectar problemas, apagar fuegos.</li>
</ul>
</li>
</ul>
<p>Los desarrolladores quieren introducir cambios r√°pidamente en el
sistema, mientras que a los t√©cnicos de operaciones les gustar√≠a
mantener el sistema lo m√°s estable posible.</p>
<p>Los profesionales <a href="https://en.wikipedia.org/wiki/DevOps"><strong>DevOps</strong></a> representan una nueva filosof√≠a de
trabajo, que combina elementos propios de los desarrolladores y de
operaciones, incorporando todas las nuevas t√©cnicas de las que hemos
estado hablando en este tema y herramientas denominadas
<a href="https://en.wikipedia.org/wiki/Infrastructure_as_code"><em>Infrastructure-as-code</em></a>
como Docker, Kubernetes, Ansible, Terraform,etc. en las que podemos definir la
configuraci√≥n de entornos y servidores usando c√≥digo y ficheros
almacenables en un sistema de control de versiones, en lugar de tener
que configurar f√≠sicamente el hardware.</p>
<h3 id="principos-y-buenas-practicas">Principos y buenas pr√°cticas</h3>
<p>En la charla mencionada anteriormente sobre pr√°cticas de integraci√≥n
continua en Carto, Juan Ignacio S√°nchez lista 10 buenas pr√°cticas que
ellos est√°n siguiendo. Muchas ya las hemos visto, pero es interesante
repasarlas todas juntas, validadas por la experiencia de su √©xito en
una empresa puntera de desarrollo de software. Son las siguientes:</p>
<ol>
<li>Mantener un repositorio de c√≥digo</li>
<li>Automatizar la compilaci√≥n</li>
<li>Hacer la compilaci√≥n auto-testeable (mediante test autom√°ticos)</li>
<li>Todo el mundo realiza commits en la rama principal todos los d√≠as</li>
<li>Cada commit en la rama principal debe ser compilado</li>
<li>Mantener la compilaci√≥n r√°pida</li>
<li>Testear en un clon del entorno de producci√≥n</li>
<li>Hacer f√°cil de obtener los √∫ltimos productos compilados</li>
<li>Todo el mundo puede ver los resultados de las √∫ltimas compilaciones</li>
<li>Automatizar el despliegue</li>
</ol>
<h2 id="consejos-adicionales">Consejos adicionales</h2>
<p>La integraci√≥n continua y el despliegue continuo son dos conceptos que pueden convertirse en aliados muy poderosos para nuestro equipo si ponemos los medios necesarios.</p>
<p>Es obvio que nada de esto es posible sin una bater√≠a de pruebas s√≥lidas, extensas y consistentes. Si no disponemos de pruebas unitarias de calidad y que cubran la totalidad de nuestro c√≥digo, lo m√°s probable es que nuestro CI nos de muchos falsos positivos (fallos que no han sido detectados por las pruebas unitarias), que a su vez provocar√° que se desplieguen fallos en nuestros entornos de pre-producci√≥n y producci√≥n.</p>
<p>Por ejemplo, si el proceso de integraci√≥n continua se ejecuta en nuestro servidor de Gitlab en vez de en el ordenador de cada desarrollador de nuestro equipo, estaremos facilitando la tarea de comprobaci√≥n automatizada de error. A√∫n m√°s importante, si dicho proceso se ejecuta en pocos minutos, estaremos creando un h√°bito entre las personas del proyecto de enviar m√°s a menudo sus cambios al repositorio, ya que hacerlo les permitir√° obtener una visi√≥n r√°pida sobre la calidad de su trabajo. Esto a su vez har√° que la frecuencia de los cambios que se env√≠an al repositorio sea m√°s alta, mientras que el tama√±o de cada cambio enviado sea m√°s peque√±o. Las tareas de revisi√≥n se har√°n m√°s amenas y f√°ciles, y por lo tanto, mejora la velocidad con la que se integran dichos cambios en ¬´develop¬ª. Nuestro equipo de control de calidad podr√° tener un flujo continuo de trabajo, lo cual reducir√° los tiempos ¬´muertos¬ª (personas ¬´bloqueadas¬ª a la espera de que otras personas terminen su trabajo).</p>
<p>Por √∫ltimo, cabe decir que no es obligatorio que el despliegue continuo tenga lugar en cuanto un cambio se mezcle en las ramas de ¬´develop¬ª o ¬´master¬ª. Existen muchos casos en los que el l√≠der del equipo (o una persona con rol similar) deber√° tomar la decisi√≥n de dar luz verde al proceso de despliegue en base a m√°s factores. Es decir, el proceso en s√≠ puede estar automatizado (es lo mas recomendable), pero la acci√≥n que desencadena el despliegue puede ser humana.</p>
<h2 id="referencias">Referencias</h2>
<ul>
<li>Charla de Eduardo Ferro (2020): <a href="https://youtu.be/hbggtXmQcf8?t=444"><em>Continuous Delivery: Germinando una
  cultura √°gil moderna</em></a>. </li>
<li>Martin Fowler (2006): <a href="https://martinfowler.com/articles/continuousIntegration.html"><em>Continuous Integration</em></a></li>
<li>Jez Humble y David Farley (2010): <a href="https://learning.oreilly.com/library/view/continuous-delivery-reliable/9780321670250/"><em>Continuous Delivery</em></a></li>
<li><a href="https://blog.develat.io/pipelines-ci-cd/">Integraci√≥n continua y despliegue continuo</a></li>
</ul>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.top", "toc.integrate", "search.highlight", "content.code.annotate", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>